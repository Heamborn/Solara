{
  "version": 3,
  "sources": ["../bundle-4YnjdV/checked-fetch.js", "../bundle-4YnjdV/strip-cf-connecting-ip-header.js", "../bundle-rEWJhS/checked-fetch.js", "../bundle-rEWJhS/strip-cf-connecting-ip-header.js", "../../../functions/api/login.ts", "../../../functions/api/storage.ts", "../../../functions/lib/vendor/jpeg-decoder.js", "../../../functions/palette.ts", "../../../functions/proxy.ts", "../../../functions/_middleware.ts", "../pages-rpwfNZ/functionsRoutes-0.6250875775069115.mjs", "../../../node_modules/path-to-regexp/src/index.ts", "../../../node_modules/wrangler/templates/pages-template-worker.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-rEWJhS/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-rEWJhS/middleware-loader.entry.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-4YnjdV/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-4YnjdV/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\\u6742\\\u97F3\u4E50\u64AD\u653E\u5668\\Solara\\.wrangler\\tmp\\dev-8kL6B3",
  "sourcesContent": ["const urls = new Set();\r\n\r\nfunction checkURL(request, init) {\r\n\tconst url =\r\n\t\trequest instanceof URL\r\n\t\t\t? request\r\n\t\t\t: new URL(\r\n\t\t\t\t\t(typeof request === \"string\"\r\n\t\t\t\t\t\t? new Request(request, init)\r\n\t\t\t\t\t\t: request\r\n\t\t\t\t\t).url\r\n\t\t\t\t);\r\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\r\n\t\tif (!urls.has(url.toString())) {\r\n\t\t\turls.add(url.toString());\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\r\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nglobalThis.fetch = new Proxy(globalThis.fetch, {\r\n\tapply(target, thisArg, argArray) {\r\n\t\tconst [request, init] = argArray;\r\n\t\tcheckURL(request, init);\r\n\t\treturn Reflect.apply(target, thisArg, argArray);\r\n\t},\r\n});\r\n", "function stripCfConnectingIPHeader(input, init) {\r\n\tconst request = new Request(input, init);\r\n\trequest.headers.delete(\"CF-Connecting-IP\");\r\n\treturn request;\r\n}\r\n\r\nglobalThis.fetch = new Proxy(globalThis.fetch, {\r\n\tapply(target, thisArg, argArray) {\r\n\t\treturn Reflect.apply(target, thisArg, [\r\n\t\t\tstripCfConnectingIPHeader.apply(null, argArray),\r\n\t\t]);\r\n\t},\r\n});\r\n", "const urls = new Set();\r\n\r\nfunction checkURL(request, init) {\r\n\tconst url =\r\n\t\trequest instanceof URL\r\n\t\t\t? request\r\n\t\t\t: new URL(\r\n\t\t\t\t\t(typeof request === \"string\"\r\n\t\t\t\t\t\t? new Request(request, init)\r\n\t\t\t\t\t\t: request\r\n\t\t\t\t\t).url\r\n\t\t\t\t);\r\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\r\n\t\tif (!urls.has(url.toString())) {\r\n\t\t\turls.add(url.toString());\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\r\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nglobalThis.fetch = new Proxy(globalThis.fetch, {\r\n\tapply(target, thisArg, argArray) {\r\n\t\tconst [request, init] = argArray;\r\n\t\tcheckURL(request, init);\r\n\t\treturn Reflect.apply(target, thisArg, argArray);\r\n\t},\r\n});\r\n", "function stripCfConnectingIPHeader(input, init) {\r\n\tconst request = new Request(input, init);\r\n\trequest.headers.delete(\"CF-Connecting-IP\");\r\n\treturn request;\r\n}\r\n\r\nglobalThis.fetch = new Proxy(globalThis.fetch, {\r\n\tapply(target, thisArg, argArray) {\r\n\t\treturn Reflect.apply(target, thisArg, [\r\n\t\t\tstripCfConnectingIPHeader.apply(null, argArray),\r\n\t\t]);\r\n\t},\r\n});\r\n", "const MAX_AGE_SECONDS = 48 * 60 * 60;\r\n\r\nexport async function onRequestPost(context: any) {\r\n  const { request, env } = context;\r\n  const passwordEnv = env.PASSWORD;\r\n  const url = new URL(request.url);\r\n\r\n  const body = await request.json().catch(() => ({ password: \"\" }));\r\n  const providedPassword = typeof body.password === \"string\" ? body.password : \"\";\r\n\r\n  if (typeof passwordEnv !== \"string\") {\r\n    return new Response(JSON.stringify({ success: true }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n\r\n  if (providedPassword === passwordEnv) {\r\n    const cookieSegments = [\r\n      `auth=${btoa(passwordEnv)}`,\r\n      `Max-Age=${MAX_AGE_SECONDS}`,\r\n      \"Path=/\",\r\n      \"SameSite=Lax\",\r\n      \"HttpOnly\",\r\n    ];\r\n    if (url.protocol === \"https:\") {\r\n      cookieSegments.push(\"Secure\");\r\n    }\r\n\r\n    return new Response(JSON.stringify({ success: true }), {\r\n      status: 200,\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"Set-Cookie\": cookieSegments.join(\"; \"),\r\n      },\r\n    });\r\n  }\r\n\r\n  return new Response(JSON.stringify({ success: false }), {\r\n    status: 401,\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  });\r\n}\r\n", "const JSON_HEADERS = {\r\n  \"Content-Type\": \"application/json\",\r\n  \"Access-Control-Allow-Origin\": \"*\",\r\n  \"Access-Control-Allow-Methods\": \"GET,POST,DELETE,OPTIONS\",\r\n  \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n};\r\n\r\ntype Env = {\r\n  DB?: D1Database;\r\n};\r\n\r\ntype StorageData = Record<string, string | null>;\r\n\r\ntype JsonBody = {\r\n  data?: Record<string, unknown>;\r\n  keys?: unknown;\r\n};\r\n\r\nconst FAVORITE_KEYS = new Set([\r\n  \"favoriteSongs\",\r\n  \"currentFavoriteIndex\",\r\n  \"favoritePlayMode\",\r\n  \"favoritePlaybackTime\",\r\n]);\r\n\r\nconst TABLES = {\r\n  playback: \"playback_store\",\r\n  favorites: \"favorites_store\",\r\n} as const;\r\n\r\ntype TableName = (typeof TABLES)[keyof typeof TABLES];\r\n\r\nfunction jsonResponse(body: unknown, status = 200): Response {\r\n  return new Response(JSON.stringify(body), {\r\n    status,\r\n    headers: JSON_HEADERS,\r\n  });\r\n}\r\n\r\nfunction hasD1(env: Env): env is Required<Env> {\r\n  return Boolean(env.DB && typeof env.DB.prepare === \"function\");\r\n}\r\n\r\nfunction getTableForKey(key: string): TableName {\r\n  if (FAVORITE_KEYS.has(key)) {\r\n    return TABLES.favorites;\r\n  }\r\n  return TABLES.playback;\r\n}\r\n\r\nasync function ensureTables(env: Env): Promise<void> {\r\n  if (!hasD1(env)) {\r\n    return;\r\n  }\r\n  const createStatements = [\r\n    env.DB.prepare(\r\n      \"CREATE TABLE IF NOT EXISTS playback_store (key TEXT PRIMARY KEY, value TEXT, updated_at TEXT DEFAULT CURRENT_TIMESTAMP)\"\r\n    ),\r\n    env.DB.prepare(\r\n      \"CREATE TABLE IF NOT EXISTS favorites_store (key TEXT PRIMARY KEY, value TEXT, updated_at TEXT DEFAULT CURRENT_TIMESTAMP)\"\r\n    ),\r\n  ];\r\n  await env.DB.batch(createStatements);\r\n}\r\n\r\nasync function handleGet(request: Request, env: Env): Promise<Response> {\r\n  const url = new URL(request.url);\r\n  if (!hasD1(env)) {\r\n    return jsonResponse({ d1Available: false, data: {} });\r\n  }\r\n\r\n  const statusOnly = url.searchParams.get(\"status\");\r\n  if (statusOnly) {\r\n    return jsonResponse({ d1Available: true });\r\n  }\r\n\r\n  const keysParam = url.searchParams.get(\"keys\") || \"\";\r\n  const keys = keysParam\r\n    .split(\",\")\r\n    .map((key) => key.trim())\r\n    .filter(Boolean);\r\n\r\n  await ensureTables(env);\r\n\r\n  const data: StorageData = {};\r\n  let rows: Array<{ key: string; value: string | null }> = [];\r\n  if (keys.length > 0) {\r\n    const groupedKeys = keys.reduce(\r\n      (acc, key) => {\r\n        const table = getTableForKey(key);\r\n        acc[table].push(key);\r\n        return acc;\r\n      },\r\n      { [TABLES.playback]: [] as string[], [TABLES.favorites]: [] as string[] }\r\n    );\r\n\r\n    const results: Array<{ key: string; value: string | null }> = [];\r\n    for (const [table, tableKeys] of Object.entries(groupedKeys)) {\r\n      if (tableKeys.length === 0) continue;\r\n      const placeholders = tableKeys.map(() => \"?\").join(\",\");\r\n      const statement = env.DB.prepare(\r\n        `SELECT key, value FROM ${table} WHERE key IN (${placeholders})`\r\n      ).bind(...tableKeys);\r\n      const result = await statement.all();\r\n      const rowsResult = (result as any).results || result.results || [];\r\n      results.push(...rowsResult);\r\n    }\r\n    rows = results;\r\n    keys.forEach((key) => {\r\n      data[key] = null;\r\n    });\r\n  } else {\r\n    const playbackResult = await env.DB.prepare(\r\n      \"SELECT key, value FROM playback_store\"\r\n    ).all();\r\n    const favoriteResult = await env.DB.prepare(\r\n      \"SELECT key, value FROM favorites_store\"\r\n    ).all();\r\n    rows = [\r\n      ...(((playbackResult as any).results || playbackResult.results || []) as any[]),\r\n      ...(((favoriteResult as any).results || favoriteResult.results || []) as any[]),\r\n    ];\r\n  }\r\n\r\n  rows.forEach((row) => {\r\n    if (!row || typeof row.key !== \"string\") return;\r\n    data[row.key] = row.value;\r\n  });\r\n\r\n  return jsonResponse({ d1Available: true, data });\r\n}\r\n\r\nasync function handlePost(request: Request, env: Env): Promise<Response> {\r\n  if (!hasD1(env)) {\r\n    return jsonResponse({ d1Available: false, data: {} });\r\n  }\r\n\r\n  const body = (await request.json().catch(() => ({}))) as JsonBody;\r\n  const payload = body.data && typeof body.data === \"object\" ? body.data : null;\r\n\r\n  if (!payload || Array.isArray(payload)) {\r\n    return jsonResponse({ error: \"Invalid payload\" }, 400);\r\n  }\r\n\r\n  const entries = Object.entries(payload).filter(([key]) => Boolean(key));\r\n  if (entries.length === 0) {\r\n    return jsonResponse({ d1Available: true, updated: 0 });\r\n  }\r\n\r\n  await ensureTables(env);\r\n\r\n  const groupedStatements: Record<string, D1PreparedStatement[]> = {\r\n    [TABLES.playback]: [],\r\n    [TABLES.favorites]: [],\r\n  };\r\n\r\n  entries.forEach(([key, value]) => {\r\n    const storedValue = value == null ? \"\" : String(value);\r\n    const table = getTableForKey(key);\r\n    groupedStatements[table].push(\r\n      env.DB.prepare(\r\n        `INSERT INTO ${table} (key, value, updated_at) VALUES (?1, ?2, datetime('now')) ON CONFLICT(key) DO UPDATE SET value = excluded.value, updated_at = excluded.updated_at`\r\n      ).bind(key, storedValue)\r\n    );\r\n  });\r\n\r\n  const batches: Promise<unknown>[] = [];\r\n  Object.values(groupedStatements).forEach((statements) => {\r\n    if (statements.length > 0) {\r\n      batches.push(env.DB.batch(statements));\r\n    }\r\n  });\r\n\r\n  await Promise.all(batches);\r\n  return jsonResponse({ d1Available: true, updated: entries.length });\r\n}\r\n\r\nasync function handleDelete(request: Request, env: Env): Promise<Response> {\r\n  if (!hasD1(env)) {\r\n    return jsonResponse({ d1Available: false });\r\n  }\r\n\r\n  const body = (await request.json().catch(() => ({}))) as JsonBody;\r\n  const keys = Array.isArray(body.keys)\r\n    ? body.keys.filter((key): key is string => typeof key === \"string\" && Boolean(key))\r\n    : [];\r\n\r\n  if (keys.length === 0) {\r\n    return jsonResponse({ d1Available: true, deleted: 0 });\r\n  }\r\n\r\n  await ensureTables(env);\r\n\r\n  const groupedStatements: Record<string, D1PreparedStatement[]> = {\r\n    [TABLES.playback]: [],\r\n    [TABLES.favorites]: [],\r\n  };\r\n\r\n  keys.forEach((key) => {\r\n    const table = getTableForKey(key);\r\n    groupedStatements[table].push(\r\n      env.DB.prepare(`DELETE FROM ${table} WHERE key = ?1`).bind(key)\r\n    );\r\n  });\r\n\r\n  const batches: Promise<unknown>[] = [];\r\n  Object.values(groupedStatements).forEach((statements) => {\r\n    if (statements.length > 0) {\r\n      batches.push(env.DB.batch(statements));\r\n    }\r\n  });\r\n\r\n  await Promise.all(batches);\r\n  return jsonResponse({ d1Available: true, deleted: keys.length });\r\n}\r\n\r\nexport async function onRequest(context: any): Promise<Response> {\r\n  const { request, env } = context;\r\n  const method = (request.method || \"GET\").toUpperCase();\r\n\r\n  if (method === \"OPTIONS\") {\r\n    return new Response(null, { status: 204, headers: JSON_HEADERS });\r\n  }\r\n\r\n  if (method === \"GET\") {\r\n    return handleGet(request, env);\r\n  }\r\n\r\n  if (method === \"POST\") {\r\n    return handlePost(request, env);\r\n  }\r\n\r\n  if (method === \"DELETE\") {\r\n    return handleDelete(request, env);\r\n  }\r\n\r\n  return jsonResponse({ error: \"Method not allowed\" }, 405);\r\n}\r\n", "// @ts-nocheck\r\n/* -*- tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- /\r\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\r\n/*\r\n   Copyright 2011 notmasteryet\r\n\r\n   Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   you may not use this file except in compliance with the License.\r\n   You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n   Unless required by applicable law or agreed to in writing, software\r\n   distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   See the License for the specific language governing permissions and\r\n   limitations under the License.\r\n*/\r\n\r\n// - The JPEG specification can be found in the ITU CCITT Recommendation T.81\r\n//   (www.w3.org/Graphics/JPEG/itu-t81.pdf)\r\n// - The JFIF specification can be found in the JPEG File Interchange Format\r\n//   (www.w3.org/Graphics/JPEG/jfif3.pdf)\r\n// - The Adobe Application-Specific JPEG markers in the Supporting the DCT Filters\r\n//   in PostScript Level 2, Technical Note #5116\r\n//   (partners.adobe.com/public/developer/en/ps/sdk/5116.DCT_Filter.pdf)\r\n\r\nvar JpegImage = (function jpegImage() {\r\n  \"use strict\";\r\n  var dctZigZag = new Int32Array([\r\n     0,\r\n     1,  8,\r\n    16,  9,  2,\r\n     3, 10, 17, 24,\r\n    32, 25, 18, 11, 4,\r\n     5, 12, 19, 26, 33, 40,\r\n    48, 41, 34, 27, 20, 13,  6,\r\n     7, 14, 21, 28, 35, 42, 49, 56,\r\n    57, 50, 43, 36, 29, 22, 15,\r\n    23, 30, 37, 44, 51, 58,\r\n    59, 52, 45, 38, 31,\r\n    39, 46, 53, 60,\r\n    61, 54, 47,\r\n    55, 62,\r\n    63\r\n  ]);\r\n\r\n  var dctCos1  =  4017   // cos(pi/16)\r\n  var dctSin1  =   799   // sin(pi/16)\r\n  var dctCos3  =  3406   // cos(3*pi/16)\r\n  var dctSin3  =  2276   // sin(3*pi/16)\r\n  var dctCos6  =  1567   // cos(6*pi/16)\r\n  var dctSin6  =  3784   // sin(6*pi/16)\r\n  var dctSqrt2 =  5793   // sqrt(2)\r\n  var dctSqrt1d2 = 2896  // sqrt(2) / 2\r\n\r\n  function constructor() {\r\n  }\r\n\r\n  function buildHuffmanTable(codeLengths, values) {\r\n    var k = 0, code = [], i, j, length = 16;\r\n    while (length > 0 && !codeLengths[length - 1])\r\n      length--;\r\n    code.push({children: [], index: 0});\r\n    var p = code[0], q;\r\n    for (i = 0; i < length; i++) {\r\n      for (j = 0; j < codeLengths[i]; j++) {\r\n        p = code.pop();\r\n        p.children[p.index] = values[k];\r\n        while (p.index > 0) {\r\n          if (code.length === 0)\r\n            throw new Error('Could not recreate Huffman Table');\r\n          p = code.pop();\r\n        }\r\n        p.index++;\r\n        code.push(p);\r\n        while (code.length <= i) {\r\n          code.push(q = {children: [], index: 0});\r\n          p.children[p.index] = q.children;\r\n          p = q;\r\n        }\r\n        k++;\r\n      }\r\n      if (i + 1 < length) {\r\n        // p here points to last code\r\n        code.push(q = {children: [], index: 0});\r\n        p.children[p.index] = q.children;\r\n        p = q;\r\n      }\r\n    }\r\n    return code[0].children;\r\n  }\r\n\r\n  function decodeScan(data, offset,\r\n                      frame, components, resetInterval,\r\n                      spectralStart, spectralEnd,\r\n                      successivePrev, successive, opts) {\r\n    var precision = frame.precision;\r\n    var samplesPerLine = frame.samplesPerLine;\r\n    var scanLines = frame.scanLines;\r\n    var mcusPerLine = frame.mcusPerLine;\r\n    var progressive = frame.progressive;\r\n    var maxH = frame.maxH, maxV = frame.maxV;\r\n\r\n    var startOffset = offset, bitsData = 0, bitsCount = 0;\r\n    function readBit() {\r\n      if (bitsCount > 0) {\r\n        bitsCount--;\r\n        return (bitsData >> bitsCount) & 1;\r\n      }\r\n      bitsData = data[offset++];\r\n      if (bitsData == 0xFF) {\r\n        var nextByte = data[offset++];\r\n        if (nextByte) {\r\n          throw new Error(\"unexpected marker: \" + ((bitsData << 8) | nextByte).toString(16));\r\n        }\r\n        // unstuff 0\r\n      }\r\n      bitsCount = 7;\r\n      return bitsData >>> 7;\r\n    }\r\n    function decodeHuffman(tree) {\r\n      var node = tree, bit;\r\n      while ((bit = readBit()) !== null) {\r\n        node = node[bit];\r\n        if (typeof node === 'number')\r\n          return node;\r\n        if (typeof node !== 'object')\r\n          throw new Error(\"invalid huffman sequence\");\r\n      }\r\n      return null;\r\n    }\r\n    function receive(length) {\r\n      var n = 0;\r\n      while (length > 0) {\r\n        var bit = readBit();\r\n        if (bit === null) return;\r\n        n = (n << 1) | bit;\r\n        length--;\r\n      }\r\n      return n;\r\n    }\r\n    function receiveAndExtend(length) {\r\n      var n = receive(length);\r\n      if (n >= 1 << (length - 1))\r\n        return n;\r\n      return n + (-1 << length) + 1;\r\n    }\r\n    function decodeBaseline(component, zz) {\r\n      var t = decodeHuffman(component.huffmanTableDC);\r\n      var diff = t === 0 ? 0 : receiveAndExtend(t);\r\n      zz[0]= (component.pred += diff);\r\n      var k = 1;\r\n      while (k < 64) {\r\n        var rs = decodeHuffman(component.huffmanTableAC);\r\n        var s = rs & 15, r = rs >> 4;\r\n        if (s === 0) {\r\n          if (r < 15)\r\n            break;\r\n          k += 16;\r\n          continue;\r\n        }\r\n        k += r;\r\n        var z = dctZigZag[k];\r\n        zz[z] = receiveAndExtend(s);\r\n        k++;\r\n      }\r\n    }\r\n    function decodeDCFirst(component, zz) {\r\n      var t = decodeHuffman(component.huffmanTableDC);\r\n      var diff = t === 0 ? 0 : (receiveAndExtend(t) << successive);\r\n      zz[0] = (component.pred += diff);\r\n    }\r\n    function decodeDCSuccessive(component, zz) {\r\n      zz[0] |= readBit() << successive;\r\n    }\r\n    var eobrun = 0;\r\n    function decodeACFirst(component, zz) {\r\n      if (eobrun > 0) {\r\n        eobrun--;\r\n        return;\r\n      }\r\n      var k = spectralStart, e = spectralEnd;\r\n      while (k <= e) {\r\n        var rs = decodeHuffman(component.huffmanTableAC);\r\n        var s = rs & 15, r = rs >> 4;\r\n        if (s === 0) {\r\n          if (r < 15) {\r\n            eobrun = receive(r) + (1 << r) - 1;\r\n            break;\r\n          }\r\n          k += 16;\r\n          continue;\r\n        }\r\n        k += r;\r\n        var z = dctZigZag[k];\r\n        zz[z] = receiveAndExtend(s) * (1 << successive);\r\n        k++;\r\n      }\r\n    }\r\n    var successiveACState = 0, successiveACNextValue;\r\n    function decodeACSuccessive(component, zz) {\r\n      var k = spectralStart, e = spectralEnd, r = 0;\r\n      while (k <= e) {\r\n        var z = dctZigZag[k];\r\n        var direction = zz[z] < 0 ? -1 : 1;\r\n        switch (successiveACState) {\r\n        case 0: // initial state\r\n          var rs = decodeHuffman(component.huffmanTableAC);\r\n          var s = rs & 15, r = rs >> 4;\r\n          if (s === 0) {\r\n            if (r < 15) {\r\n              eobrun = receive(r) + (1 << r);\r\n              successiveACState = 4;\r\n            } else {\r\n              r = 16;\r\n              successiveACState = 1;\r\n            }\r\n          } else {\r\n            if (s !== 1)\r\n              throw new Error(\"invalid ACn encoding\");\r\n            successiveACNextValue = receiveAndExtend(s);\r\n            successiveACState = r ? 2 : 3;\r\n          }\r\n          continue;\r\n        case 1: // skipping r zero items\r\n        case 2:\r\n          if (zz[z])\r\n            zz[z] += (readBit() << successive) * direction;\r\n          else {\r\n            r--;\r\n            if (r === 0)\r\n              successiveACState = successiveACState == 2 ? 3 : 0;\r\n          }\r\n          break;\r\n        case 3: // set value for a zero item\r\n          if (zz[z])\r\n            zz[z] += (readBit() << successive) * direction;\r\n          else {\r\n            zz[z] = successiveACNextValue << successive;\r\n            successiveACState = 0;\r\n          }\r\n          break;\r\n        case 4: // eob\r\n          if (zz[z])\r\n            zz[z] += (readBit() << successive) * direction;\r\n          break;\r\n        }\r\n        k++;\r\n      }\r\n      if (successiveACState === 4) {\r\n        eobrun--;\r\n        if (eobrun === 0)\r\n          successiveACState = 0;\r\n      }\r\n    }\r\n    function decodeMcu(component, decode, mcu, row, col) {\r\n      var mcuRow = (mcu / mcusPerLine) | 0;\r\n      var mcuCol = mcu % mcusPerLine;\r\n      var blockRow = mcuRow * component.v + row;\r\n      var blockCol = mcuCol * component.h + col;\r\n      // If the block is missing and we're in tolerant mode, just skip it.\r\n      if (component.blocks[blockRow] === undefined && opts.tolerantDecoding)\r\n        return;\r\n      decode(component, component.blocks[blockRow][blockCol]);\r\n    }\r\n    function decodeBlock(component, decode, mcu) {\r\n      var blockRow = (mcu / component.blocksPerLine) | 0;\r\n      var blockCol = mcu % component.blocksPerLine;\r\n      // If the block is missing and we're in tolerant mode, just skip it.\r\n      if (component.blocks[blockRow] === undefined && opts.tolerantDecoding)\r\n        return;\r\n      decode(component, component.blocks[blockRow][blockCol]);\r\n    }\r\n\r\n    var componentsLength = components.length;\r\n    var component, i, j, k, n;\r\n    var decodeFn;\r\n    if (progressive) {\r\n      if (spectralStart === 0)\r\n        decodeFn = successivePrev === 0 ? decodeDCFirst : decodeDCSuccessive;\r\n      else\r\n        decodeFn = successivePrev === 0 ? decodeACFirst : decodeACSuccessive;\r\n    } else {\r\n      decodeFn = decodeBaseline;\r\n    }\r\n\r\n    var mcu = 0, marker;\r\n    var mcuExpected;\r\n    if (componentsLength == 1) {\r\n      mcuExpected = components[0].blocksPerLine * components[0].blocksPerColumn;\r\n    } else {\r\n      mcuExpected = mcusPerLine * frame.mcusPerColumn;\r\n    }\r\n    if (!resetInterval) resetInterval = mcuExpected;\r\n\r\n    var h, v;\r\n    while (mcu < mcuExpected) {\r\n      // reset interval stuff\r\n      for (i = 0; i < componentsLength; i++)\r\n        components[i].pred = 0;\r\n      eobrun = 0;\r\n\r\n      if (componentsLength == 1) {\r\n        component = components[0];\r\n        for (n = 0; n < resetInterval; n++) {\r\n          decodeBlock(component, decodeFn, mcu);\r\n          mcu++;\r\n        }\r\n      } else {\r\n        for (n = 0; n < resetInterval; n++) {\r\n          for (i = 0; i < componentsLength; i++) {\r\n            component = components[i];\r\n            h = component.h;\r\n            v = component.v;\r\n            for (j = 0; j < v; j++) {\r\n              for (k = 0; k < h; k++) {\r\n                decodeMcu(component, decodeFn, mcu, j, k);\r\n              }\r\n            }\r\n          }\r\n          mcu++;\r\n\r\n          // If we've reached our expected MCU's, stop decoding\r\n          if (mcu === mcuExpected) break;\r\n        }\r\n      }\r\n\r\n      if (mcu === mcuExpected) {\r\n        // Skip trailing bytes at the end of the scan - until we reach the next marker\r\n        do {\r\n          if (data[offset] === 0xFF) {\r\n            if (data[offset + 1] !== 0x00) {\r\n              break;\r\n            }\r\n          }\r\n          offset += 1;\r\n        } while (offset < data.length - 2);\r\n      }\r\n\r\n      // find marker\r\n      bitsCount = 0;\r\n      marker = (data[offset] << 8) | data[offset + 1];\r\n      if (marker < 0xFF00) {\r\n        throw new Error(\"marker was not found\");\r\n      }\r\n\r\n      if (marker >= 0xFFD0 && marker <= 0xFFD7) { // RSTx\r\n        offset += 2;\r\n      }\r\n      else\r\n        break;\r\n    }\r\n\r\n    return offset - startOffset;\r\n  }\r\n\r\n  function buildComponentData(frame, component) {\r\n    var lines = [];\r\n    var blocksPerLine = component.blocksPerLine;\r\n    var blocksPerColumn = component.blocksPerColumn;\r\n    var samplesPerLine = blocksPerLine << 3;\r\n    // Only 1 used per invocation of this function and garbage collected after invocation, so no need to account for its memory footprint.\r\n    var R = new Int32Array(64), r = new Uint8Array(64);\r\n\r\n    // A port of poppler's IDCT method which in turn is taken from:\r\n    //   Christoph Loeffler, Adriaan Ligtenberg, George S. Moschytz,\r\n    //   \"Practical Fast 1-D DCT Algorithms with 11 Multiplications\",\r\n    //   IEEE Intl. Conf. on Acoustics, Speech & Signal Processing, 1989,\r\n    //   988-991.\r\n    function quantizeAndInverse(zz, dataOut, dataIn) {\r\n      var qt = component.quantizationTable;\r\n      var v0, v1, v2, v3, v4, v5, v6, v7, t;\r\n      var p = dataIn;\r\n      var i;\r\n\r\n      // dequant\r\n      for (i = 0; i < 64; i++)\r\n        p[i] = zz[i] * qt[i];\r\n\r\n      // inverse DCT on rows\r\n      for (i = 0; i < 8; ++i) {\r\n        var row = 8 * i;\r\n\r\n        // check for all-zero AC coefficients\r\n        if (p[1 + row] == 0 && p[2 + row] == 0 && p[3 + row] == 0 &&\r\n            p[4 + row] == 0 && p[5 + row] == 0 && p[6 + row] == 0 &&\r\n            p[7 + row] == 0) {\r\n          t = (dctSqrt2 * p[0 + row] + 512) >> 10;\r\n          p[0 + row] = t;\r\n          p[1 + row] = t;\r\n          p[2 + row] = t;\r\n          p[3 + row] = t;\r\n          p[4 + row] = t;\r\n          p[5 + row] = t;\r\n          p[6 + row] = t;\r\n          p[7 + row] = t;\r\n          continue;\r\n        }\r\n\r\n        // stage 4\r\n        v0 = (dctSqrt2 * p[0 + row] + 128) >> 8;\r\n        v1 = (dctSqrt2 * p[4 + row] + 128) >> 8;\r\n        v2 = p[2 + row];\r\n        v3 = p[6 + row];\r\n        v4 = (dctSqrt1d2 * (p[1 + row] - p[7 + row]) + 128) >> 8;\r\n        v7 = (dctSqrt1d2 * (p[1 + row] + p[7 + row]) + 128) >> 8;\r\n        v5 = p[3 + row] << 4;\r\n        v6 = p[5 + row] << 4;\r\n\r\n        // stage 3\r\n        t = (v0 - v1+ 1) >> 1;\r\n        v0 = (v0 + v1 + 1) >> 1;\r\n        v1 = t;\r\n        t = (v2 * dctSin6 + v3 * dctCos6 + 128) >> 8;\r\n        v2 = (v2 * dctCos6 - v3 * dctSin6 + 128) >> 8;\r\n        v3 = t;\r\n        t = (v4 - v6 + 1) >> 1;\r\n        v4 = (v4 + v6 + 1) >> 1;\r\n        v6 = t;\r\n        t = (v7 + v5 + 1) >> 1;\r\n        v5 = (v7 - v5 + 1) >> 1;\r\n        v7 = t;\r\n\r\n        // stage 2\r\n        t = (v0 - v3 + 1) >> 1;\r\n        v0 = (v0 + v3 + 1) >> 1;\r\n        v3 = t;\r\n        t = (v1 - v2 + 1) >> 1;\r\n        v1 = (v1 + v2 + 1) >> 1;\r\n        v2 = t;\r\n        t = (v4 * dctSin3 + v7 * dctCos3 + 2048) >> 12;\r\n        v4 = (v4 * dctCos3 - v7 * dctSin3 + 2048) >> 12;\r\n        v7 = t;\r\n        t = (v5 * dctSin1 + v6 * dctCos1 + 2048) >> 12;\r\n        v5 = (v5 * dctCos1 - v6 * dctSin1 + 2048) >> 12;\r\n        v6 = t;\r\n\r\n        // stage 1\r\n        p[0 + row] = v0 + v7;\r\n        p[7 + row] = v0 - v7;\r\n        p[1 + row] = v1 + v6;\r\n        p[6 + row] = v1 - v6;\r\n        p[2 + row] = v2 + v5;\r\n        p[5 + row] = v2 - v5;\r\n        p[3 + row] = v3 + v4;\r\n        p[4 + row] = v3 - v4;\r\n      }\r\n\r\n      // inverse DCT on columns\r\n      for (i = 0; i < 8; ++i) {\r\n        var col = i;\r\n\r\n        // check for all-zero AC coefficients\r\n        if (p[1*8 + col] == 0 && p[2*8 + col] == 0 && p[3*8 + col] == 0 &&\r\n            p[4*8 + col] == 0 && p[5*8 + col] == 0 && p[6*8 + col] == 0 &&\r\n            p[7*8 + col] == 0) {\r\n          t = (dctSqrt2 * dataIn[i+0] + 8192) >> 14;\r\n          p[0*8 + col] = t;\r\n          p[1*8 + col] = t;\r\n          p[2*8 + col] = t;\r\n          p[3*8 + col] = t;\r\n          p[4*8 + col] = t;\r\n          p[5*8 + col] = t;\r\n          p[6*8 + col] = t;\r\n          p[7*8 + col] = t;\r\n          continue;\r\n        }\r\n\r\n        // stage 4\r\n        v0 = (dctSqrt2 * p[0*8 + col] + 2048) >> 12;\r\n        v1 = (dctSqrt2 * p[4*8 + col] + 2048) >> 12;\r\n        v2 = p[2*8 + col];\r\n        v3 = p[6*8 + col];\r\n        v4 = (dctSqrt1d2 * (p[1*8 + col] - p[7*8 + col]) + 2048) >> 12;\r\n        v7 = (dctSqrt1d2 * (p[1*8 + col] + p[7*8 + col]) + 2048) >> 12;\r\n        v5 = p[3*8 + col];\r\n        v6 = p[5*8 + col];\r\n\r\n        // stage 3\r\n        t = (v0 - v1 + 1) >> 1;\r\n        v0 = (v0 + v1 + 1) >> 1;\r\n        v1 = t;\r\n        t = (v2 * dctSin6 + v3 * dctCos6 + 2048) >> 12;\r\n        v2 = (v2 * dctCos6 - v3 * dctSin6 + 2048) >> 12;\r\n        v3 = t;\r\n        t = (v4 - v6 + 1) >> 1;\r\n        v4 = (v4 + v6 + 1) >> 1;\r\n        v6 = t;\r\n        t = (v7 + v5 + 1) >> 1;\r\n        v5 = (v7 - v5 + 1) >> 1;\r\n        v7 = t;\r\n\r\n        // stage 2\r\n        t = (v0 - v3 + 1) >> 1;\r\n        v0 = (v0 + v3 + 1) >> 1;\r\n        v3 = t;\r\n        t = (v1 - v2 + 1) >> 1;\r\n        v1 = (v1 + v2 + 1) >> 1;\r\n        v2 = t;\r\n        t = (v4 * dctSin3 + v7 * dctCos3 + 2048) >> 12;\r\n        v4 = (v4 * dctCos3 - v7 * dctSin3 + 2048) >> 12;\r\n        v7 = t;\r\n        t = (v5 * dctSin1 + v6 * dctCos1 + 2048) >> 12;\r\n        v5 = (v5 * dctCos1 - v6 * dctSin1 + 2048) >> 12;\r\n        v6 = t;\r\n\r\n        // stage 1\r\n        p[0*8 + col] = v0 + v7;\r\n        p[7*8 + col] = v0 - v7;\r\n        p[1*8 + col] = v1 + v6;\r\n        p[6*8 + col] = v1 - v6;\r\n        p[2*8 + col] = v2 + v5;\r\n        p[5*8 + col] = v2 - v5;\r\n        p[3*8 + col] = v3 + v4;\r\n        p[4*8 + col] = v3 - v4;\r\n      }\r\n\r\n      // convert to 8-bit integers\r\n      for (i = 0; i < 64; ++i) {\r\n        var sample = 128 + ((p[i] + 8) >> 4);\r\n        dataOut[i] = sample < 0 ? 0 : sample > 0xFF ? 0xFF : sample;\r\n      }\r\n    }\r\n\r\n    requestMemoryAllocation(samplesPerLine * blocksPerColumn * 8);\r\n\r\n    var i, j;\r\n    for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {\r\n      var scanLine = blockRow << 3;\r\n      for (i = 0; i < 8; i++)\r\n        lines.push(new Uint8Array(samplesPerLine));\r\n      for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {\r\n        quantizeAndInverse(component.blocks[blockRow][blockCol], r, R);\r\n\r\n        var offset = 0, sample = blockCol << 3;\r\n        for (j = 0; j < 8; j++) {\r\n          var line = lines[scanLine + j];\r\n          for (i = 0; i < 8; i++)\r\n            line[sample + i] = r[offset++];\r\n        }\r\n      }\r\n    }\r\n    return lines;\r\n  }\r\n\r\n  function clampTo8bit(a) {\r\n    return a < 0 ? 0 : a > 255 ? 255 : a;\r\n  }\r\n\r\n  constructor.prototype = {\r\n    load: function load(path) {\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open(\"GET\", path, true);\r\n      xhr.responseType = \"arraybuffer\";\r\n      xhr.onload = (function() {\r\n        // TODO catch parse error\r\n        var data = new Uint8Array(xhr.response || xhr.mozResponseArrayBuffer);\r\n        this.parse(data);\r\n        if (this.onload)\r\n          this.onload();\r\n      }).bind(this);\r\n      xhr.send(null);\r\n    },\r\n    parse: function parse(data) {\r\n      var maxResolutionInPixels = this.opts.maxResolutionInMP * 1000 * 1000;\r\n      var offset = 0, length = data.length;\r\n      function readUint16() {\r\n        var value = (data[offset] << 8) | data[offset + 1];\r\n        offset += 2;\r\n        return value;\r\n      }\r\n      function readDataBlock() {\r\n        var length = readUint16();\r\n        var array = data.subarray(offset, offset + length - 2);\r\n        offset += array.length;\r\n        return array;\r\n      }\r\n      function prepareComponents(frame) {\r\n        // According to the JPEG standard, the sampling factor must be between 1 and 4\r\n        // See https://github.com/libjpeg-turbo/libjpeg-turbo/blob/9abeff46d87bd201a952e276f3e4339556a403a3/libjpeg.txt#L1138-L1146\r\n        var maxH = 1, maxV = 1;\r\n        var component, componentId;\r\n        for (componentId in frame.components) {\r\n          if (frame.components.hasOwnProperty(componentId)) {\r\n            component = frame.components[componentId];\r\n            if (maxH < component.h) maxH = component.h;\r\n            if (maxV < component.v) maxV = component.v;\r\n          }\r\n        }\r\n        var mcusPerLine = Math.ceil(frame.samplesPerLine / 8 / maxH);\r\n        var mcusPerColumn = Math.ceil(frame.scanLines / 8 / maxV);\r\n        for (componentId in frame.components) {\r\n          if (frame.components.hasOwnProperty(componentId)) {\r\n            component = frame.components[componentId];\r\n            var blocksPerLine = Math.ceil(Math.ceil(frame.samplesPerLine / 8) * component.h / maxH);\r\n            var blocksPerColumn = Math.ceil(Math.ceil(frame.scanLines  / 8) * component.v / maxV);\r\n            var blocksPerLineForMcu = mcusPerLine * component.h;\r\n            var blocksPerColumnForMcu = mcusPerColumn * component.v;\r\n            var blocksToAllocate = blocksPerColumnForMcu * blocksPerLineForMcu;\r\n            var blocks = [];\r\n\r\n            // Each block is a Int32Array of length 64 (4 x 64 = 256 bytes)\r\n            requestMemoryAllocation(blocksToAllocate * 256);\r\n\r\n            for (var i = 0; i < blocksPerColumnForMcu; i++) {\r\n              var row = [];\r\n              for (var j = 0; j < blocksPerLineForMcu; j++)\r\n                row.push(new Int32Array(64));\r\n              blocks.push(row);\r\n            }\r\n            component.blocksPerLine = blocksPerLine;\r\n            component.blocksPerColumn = blocksPerColumn;\r\n            component.blocks = blocks;\r\n          }\r\n        }\r\n        frame.maxH = maxH;\r\n        frame.maxV = maxV;\r\n        frame.mcusPerLine = mcusPerLine;\r\n        frame.mcusPerColumn = mcusPerColumn;\r\n      }\r\n      var jfif = null;\r\n      var adobe = null;\r\n      var pixels = null;\r\n      var frame, resetInterval;\r\n      var quantizationTables = [], frames = [];\r\n      var huffmanTablesAC = [], huffmanTablesDC = [];\r\n      var fileMarker = readUint16();\r\n      var malformedDataOffset = -1;\r\n      this.comments = [];\r\n      if (fileMarker != 0xFFD8) { // SOI (Start of Image)\r\n        throw new Error(\"SOI not found\");\r\n      }\r\n\r\n      fileMarker = readUint16();\r\n      while (fileMarker != 0xFFD9) { // EOI (End of image)\r\n        var i, j, l;\r\n        switch(fileMarker) {\r\n          case 0xFF00: break;\r\n          case 0xFFE0: // APP0 (Application Specific)\r\n          case 0xFFE1: // APP1\r\n          case 0xFFE2: // APP2\r\n          case 0xFFE3: // APP3\r\n          case 0xFFE4: // APP4\r\n          case 0xFFE5: // APP5\r\n          case 0xFFE6: // APP6\r\n          case 0xFFE7: // APP7\r\n          case 0xFFE8: // APP8\r\n          case 0xFFE9: // APP9\r\n          case 0xFFEA: // APP10\r\n          case 0xFFEB: // APP11\r\n          case 0xFFEC: // APP12\r\n          case 0xFFED: // APP13\r\n          case 0xFFEE: // APP14\r\n          case 0xFFEF: // APP15\r\n          case 0xFFFE: // COM (Comment)\r\n            var appData = readDataBlock();\r\n\r\n            if (fileMarker === 0xFFFE) {\r\n              var comment = String.fromCharCode.apply(null, appData);\r\n              this.comments.push(comment);\r\n            }\r\n\r\n            if (fileMarker === 0xFFE0) {\r\n              if (appData[0] === 0x4A && appData[1] === 0x46 && appData[2] === 0x49 &&\r\n                appData[3] === 0x46 && appData[4] === 0) { // 'JFIF\\x00'\r\n                jfif = {\r\n                  version: { major: appData[5], minor: appData[6] },\r\n                  densityUnits: appData[7],\r\n                  xDensity: (appData[8] << 8) | appData[9],\r\n                  yDensity: (appData[10] << 8) | appData[11],\r\n                  thumbWidth: appData[12],\r\n                  thumbHeight: appData[13],\r\n                  thumbData: appData.subarray(14, 14 + 3 * appData[12] * appData[13])\r\n                };\r\n              }\r\n            }\r\n            // TODO APP1 - Exif\r\n            if (fileMarker === 0xFFE1) {\r\n              if (appData[0] === 0x45 &&\r\n                appData[1] === 0x78 &&\r\n                appData[2] === 0x69 &&\r\n                appData[3] === 0x66 &&\r\n                appData[4] === 0) { // 'EXIF\\x00'\r\n                this.exifBuffer = appData.subarray(5, appData.length);\r\n              }\r\n            }\r\n\r\n            if (fileMarker === 0xFFEE) {\r\n              if (appData[0] === 0x41 && appData[1] === 0x64 && appData[2] === 0x6F &&\r\n                appData[3] === 0x62 && appData[4] === 0x65 && appData[5] === 0) { // 'Adobe\\x00'\r\n                adobe = {\r\n                  version: appData[6],\r\n                  flags0: (appData[7] << 8) | appData[8],\r\n                  flags1: (appData[9] << 8) | appData[10],\r\n                  transformCode: appData[11]\r\n                };\r\n              }\r\n            }\r\n            break;\r\n\r\n          case 0xFFDB: // DQT (Define Quantization Tables)\r\n            var quantizationTablesLength = readUint16();\r\n            var quantizationTablesEnd = quantizationTablesLength + offset - 2;\r\n            while (offset < quantizationTablesEnd) {\r\n              var quantizationTableSpec = data[offset++];\r\n              requestMemoryAllocation(64 * 4);\r\n              var tableData = new Int32Array(64);\r\n              if ((quantizationTableSpec >> 4) === 0) { // 8 bit values\r\n                for (j = 0; j < 64; j++) {\r\n                  var z = dctZigZag[j];\r\n                  tableData[z] = data[offset++];\r\n                }\r\n              } else if ((quantizationTableSpec >> 4) === 1) { //16 bit\r\n                for (j = 0; j < 64; j++) {\r\n                  var z = dctZigZag[j];\r\n                  tableData[z] = readUint16();\r\n                }\r\n              } else\r\n                throw new Error(\"DQT: invalid table spec\");\r\n              quantizationTables[quantizationTableSpec & 15] = tableData;\r\n            }\r\n            break;\r\n\r\n          case 0xFFC0: // SOF0 (Start of Frame, Baseline DCT)\r\n          case 0xFFC1: // SOF1 (Start of Frame, Extended DCT)\r\n          case 0xFFC2: // SOF2 (Start of Frame, Progressive DCT)\r\n            readUint16(); // skip data length\r\n            frame = {};\r\n            frame.extended = (fileMarker === 0xFFC1);\r\n            frame.progressive = (fileMarker === 0xFFC2);\r\n            frame.precision = data[offset++];\r\n            frame.scanLines = readUint16();\r\n            frame.samplesPerLine = readUint16();\r\n            frame.components = {};\r\n            frame.componentsOrder = [];\r\n\r\n            var pixelsInFrame = frame.scanLines * frame.samplesPerLine;\r\n            if (pixelsInFrame > maxResolutionInPixels) {\r\n              var exceededAmount = Math.ceil((pixelsInFrame - maxResolutionInPixels) / 1e6);\r\n              throw new Error(`maxResolutionInMP limit exceeded by ${exceededAmount}MP`);\r\n            }\r\n\r\n            var componentsCount = data[offset++], componentId;\r\n            var maxH = 0, maxV = 0;\r\n            for (i = 0; i < componentsCount; i++) {\r\n              componentId = data[offset];\r\n              var h = data[offset + 1] >> 4;\r\n              var v = data[offset + 1] & 15;\r\n              var qId = data[offset + 2];\r\n\r\n              if ( h <= 0 || v <= 0 ) {\r\n                throw new Error('Invalid sampling factor, expected values above 0');\r\n              }\r\n\r\n              frame.componentsOrder.push(componentId);\r\n              frame.components[componentId] = {\r\n                h: h,\r\n                v: v,\r\n                quantizationIdx: qId\r\n              };\r\n              offset += 3;\r\n            }\r\n            prepareComponents(frame);\r\n            frames.push(frame);\r\n            break;\r\n\r\n          case 0xFFC4: // DHT (Define Huffman Tables)\r\n            var huffmanLength = readUint16();\r\n            for (i = 2; i < huffmanLength;) {\r\n              var huffmanTableSpec = data[offset++];\r\n              var codeLengths = new Uint8Array(16);\r\n              var codeLengthSum = 0;\r\n              for (j = 0; j < 16; j++, offset++) {\r\n                codeLengthSum += (codeLengths[j] = data[offset]);\r\n              }\r\n              requestMemoryAllocation(16 + codeLengthSum);\r\n              var huffmanValues = new Uint8Array(codeLengthSum);\r\n              for (j = 0; j < codeLengthSum; j++, offset++)\r\n                huffmanValues[j] = data[offset];\r\n              i += 17 + codeLengthSum;\r\n\r\n              ((huffmanTableSpec >> 4) === 0 ?\r\n                huffmanTablesDC : huffmanTablesAC)[huffmanTableSpec & 15] =\r\n                buildHuffmanTable(codeLengths, huffmanValues);\r\n            }\r\n            break;\r\n\r\n          case 0xFFDD: // DRI (Define Restart Interval)\r\n            readUint16(); // skip data length\r\n            resetInterval = readUint16();\r\n            break;\r\n\r\n          case 0xFFDC: // Number of Lines marker\r\n            readUint16() // skip data length\r\n            readUint16() // Ignore this data since it represents the image height\r\n            break;\r\n            \r\n          case 0xFFDA: // SOS (Start of Scan)\r\n            var scanLength = readUint16();\r\n            var selectorsCount = data[offset++];\r\n            var components = [], component;\r\n            for (i = 0; i < selectorsCount; i++) {\r\n              component = frame.components[data[offset++]];\r\n              var tableSpec = data[offset++];\r\n              component.huffmanTableDC = huffmanTablesDC[tableSpec >> 4];\r\n              component.huffmanTableAC = huffmanTablesAC[tableSpec & 15];\r\n              components.push(component);\r\n            }\r\n            var spectralStart = data[offset++];\r\n            var spectralEnd = data[offset++];\r\n            var successiveApproximation = data[offset++];\r\n            var processed = decodeScan(data, offset,\r\n              frame, components, resetInterval,\r\n              spectralStart, spectralEnd,\r\n              successiveApproximation >> 4, successiveApproximation & 15, this.opts);\r\n            offset += processed;\r\n            break;\r\n\r\n          case 0xFFFF: // Fill bytes\r\n            if (data[offset] !== 0xFF) { // Avoid skipping a valid marker.\r\n              offset--;\r\n            }\r\n            break;\r\n          default:\r\n            if (data[offset - 3] == 0xFF &&\r\n                data[offset - 2] >= 0xC0 && data[offset - 2] <= 0xFE) {\r\n              // could be incorrect encoding -- last 0xFF byte of the previous\r\n              // block was eaten by the encoder\r\n              offset -= 3;\r\n              break;\r\n            }\r\n            else if (fileMarker === 0xE0 || fileMarker == 0xE1) {\r\n              // Recover from malformed APP1 markers popular in some phone models.\r\n              // See https://github.com/eugeneware/jpeg-js/issues/82\r\n              if (malformedDataOffset !== -1) {\r\n                throw new Error(`first unknown JPEG marker at offset ${malformedDataOffset.toString(16)}, second unknown JPEG marker ${fileMarker.toString(16)} at offset ${(offset - 1).toString(16)}`);\r\n              }\r\n              malformedDataOffset = offset - 1;\r\n              const nextOffset = readUint16();\r\n              if (data[offset + nextOffset - 2] === 0xFF) {\r\n                offset += nextOffset - 2;\r\n                break;\r\n              }\r\n            }\r\n            throw new Error(\"unknown JPEG marker \" + fileMarker.toString(16));\r\n        }\r\n        fileMarker = readUint16();\r\n      }\r\n      if (frames.length != 1)\r\n        throw new Error(\"only single frame JPEGs supported\");\r\n\r\n      // set each frame's components quantization table\r\n      for (var i = 0; i < frames.length; i++) {\r\n        var cp = frames[i].components;\r\n        for (var j in cp) {\r\n          cp[j].quantizationTable = quantizationTables[cp[j].quantizationIdx];\r\n          delete cp[j].quantizationIdx;\r\n        }\r\n      }\r\n\r\n      this.width = frame.samplesPerLine;\r\n      this.height = frame.scanLines;\r\n      this.jfif = jfif;\r\n      this.adobe = adobe;\r\n      this.components = [];\r\n      for (var i = 0; i < frame.componentsOrder.length; i++) {\r\n        var component = frame.components[frame.componentsOrder[i]];\r\n        this.components.push({\r\n          lines: buildComponentData(frame, component),\r\n          scaleX: component.h / frame.maxH,\r\n          scaleY: component.v / frame.maxV\r\n        });\r\n      }\r\n    },\r\n    getData: function getData(width, height) {\r\n      var scaleX = this.width / width, scaleY = this.height / height;\r\n\r\n      var component1, component2, component3, component4;\r\n      var component1Line, component2Line, component3Line, component4Line;\r\n      var x, y;\r\n      var offset = 0;\r\n      var Y, Cb, Cr, K, C, M, Ye, R, G, B;\r\n      var colorTransform;\r\n      var dataLength = width * height * this.components.length;\r\n      requestMemoryAllocation(dataLength);\r\n      var data = new Uint8Array(dataLength);\r\n      switch (this.components.length) {\r\n        case 1:\r\n          component1 = this.components[0];\r\n          for (y = 0; y < height; y++) {\r\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\r\n            for (x = 0; x < width; x++) {\r\n              Y = component1Line[0 | (x * component1.scaleX * scaleX)];\r\n\r\n              data[offset++] = Y;\r\n            }\r\n          }\r\n          break;\r\n        case 2:\r\n          // PDF might compress two component data in custom colorspace\r\n          component1 = this.components[0];\r\n          component2 = this.components[1];\r\n          for (y = 0; y < height; y++) {\r\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\r\n            component2Line = component2.lines[0 | (y * component2.scaleY * scaleY)];\r\n            for (x = 0; x < width; x++) {\r\n              Y = component1Line[0 | (x * component1.scaleX * scaleX)];\r\n              data[offset++] = Y;\r\n              Y = component2Line[0 | (x * component2.scaleX * scaleX)];\r\n              data[offset++] = Y;\r\n            }\r\n          }\r\n          break;\r\n        case 3:\r\n          // The default transform for three components is true\r\n          colorTransform = true;\r\n          // The adobe transform marker overrides any previous setting\r\n          if (this.adobe && this.adobe.transformCode)\r\n            colorTransform = true;\r\n          else if (typeof this.opts.colorTransform !== 'undefined')\r\n            colorTransform = !!this.opts.colorTransform;\r\n\r\n          component1 = this.components[0];\r\n          component2 = this.components[1];\r\n          component3 = this.components[2];\r\n          for (y = 0; y < height; y++) {\r\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\r\n            component2Line = component2.lines[0 | (y * component2.scaleY * scaleY)];\r\n            component3Line = component3.lines[0 | (y * component3.scaleY * scaleY)];\r\n            for (x = 0; x < width; x++) {\r\n              if (!colorTransform) {\r\n                R = component1Line[0 | (x * component1.scaleX * scaleX)];\r\n                G = component2Line[0 | (x * component2.scaleX * scaleX)];\r\n                B = component3Line[0 | (x * component3.scaleX * scaleX)];\r\n              } else {\r\n                Y = component1Line[0 | (x * component1.scaleX * scaleX)];\r\n                Cb = component2Line[0 | (x * component2.scaleX * scaleX)];\r\n                Cr = component3Line[0 | (x * component3.scaleX * scaleX)];\r\n\r\n                R = clampTo8bit(Y + 1.402 * (Cr - 128));\r\n                G = clampTo8bit(Y - 0.3441363 * (Cb - 128) - 0.71413636 * (Cr - 128));\r\n                B = clampTo8bit(Y + 1.772 * (Cb - 128));\r\n              }\r\n\r\n              data[offset++] = R;\r\n              data[offset++] = G;\r\n              data[offset++] = B;\r\n            }\r\n          }\r\n          break;\r\n        case 4:\r\n          if (!this.adobe)\r\n            throw new Error('Unsupported color mode (4 components)');\r\n          // The default transform for four components is false\r\n          colorTransform = false;\r\n          // The adobe transform marker overrides any previous setting\r\n          if (this.adobe && this.adobe.transformCode)\r\n            colorTransform = true;\r\n          else if (typeof this.opts.colorTransform !== 'undefined')\r\n            colorTransform = !!this.opts.colorTransform;\r\n\r\n          component1 = this.components[0];\r\n          component2 = this.components[1];\r\n          component3 = this.components[2];\r\n          component4 = this.components[3];\r\n          for (y = 0; y < height; y++) {\r\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\r\n            component2Line = component2.lines[0 | (y * component2.scaleY * scaleY)];\r\n            component3Line = component3.lines[0 | (y * component3.scaleY * scaleY)];\r\n            component4Line = component4.lines[0 | (y * component4.scaleY * scaleY)];\r\n            for (x = 0; x < width; x++) {\r\n              if (!colorTransform) {\r\n                C = component1Line[0 | (x * component1.scaleX * scaleX)];\r\n                M = component2Line[0 | (x * component2.scaleX * scaleX)];\r\n                Ye = component3Line[0 | (x * component3.scaleX * scaleX)];\r\n                K = component4Line[0 | (x * component4.scaleX * scaleX)];\r\n              } else {\r\n                Y = component1Line[0 | (x * component1.scaleX * scaleX)];\r\n                Cb = component2Line[0 | (x * component2.scaleX * scaleX)];\r\n                Cr = component3Line[0 | (x * component3.scaleX * scaleX)];\r\n                K = component4Line[0 | (x * component4.scaleX * scaleX)];\r\n\r\n                C = 255 - clampTo8bit(Y + 1.402 * (Cr - 128));\r\n                M = 255 - clampTo8bit(Y - 0.3441363 * (Cb - 128) - 0.71413636 * (Cr - 128));\r\n                Ye = 255 - clampTo8bit(Y + 1.772 * (Cb - 128));\r\n              }\r\n              data[offset++] = 255-C;\r\n              data[offset++] = 255-M;\r\n              data[offset++] = 255-Ye;\r\n              data[offset++] = 255-K;\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n          throw new Error('Unsupported color mode');\r\n      }\r\n      return data;\r\n    },\r\n    copyToImageData: function copyToImageData(imageData, formatAsRGBA) {\r\n      var width = imageData.width, height = imageData.height;\r\n      var imageDataArray = imageData.data;\r\n      var data = this.getData(width, height);\r\n      var i = 0, j = 0, x, y;\r\n      var Y, K, C, M, R, G, B;\r\n      switch (this.components.length) {\r\n        case 1:\r\n          for (y = 0; y < height; y++) {\r\n            for (x = 0; x < width; x++) {\r\n              Y = data[i++];\r\n\r\n              imageDataArray[j++] = Y;\r\n              imageDataArray[j++] = Y;\r\n              imageDataArray[j++] = Y;\r\n              if (formatAsRGBA) {\r\n                imageDataArray[j++] = 255;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 3:\r\n          for (y = 0; y < height; y++) {\r\n            for (x = 0; x < width; x++) {\r\n              R = data[i++];\r\n              G = data[i++];\r\n              B = data[i++];\r\n\r\n              imageDataArray[j++] = R;\r\n              imageDataArray[j++] = G;\r\n              imageDataArray[j++] = B;\r\n              if (formatAsRGBA) {\r\n                imageDataArray[j++] = 255;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 4:\r\n          for (y = 0; y < height; y++) {\r\n            for (x = 0; x < width; x++) {\r\n              C = data[i++];\r\n              M = data[i++];\r\n              Y = data[i++];\r\n              K = data[i++];\r\n\r\n              R = 255 - clampTo8bit(C * (1 - K / 255) + K);\r\n              G = 255 - clampTo8bit(M * (1 - K / 255) + K);\r\n              B = 255 - clampTo8bit(Y * (1 - K / 255) + K);\r\n\r\n              imageDataArray[j++] = R;\r\n              imageDataArray[j++] = G;\r\n              imageDataArray[j++] = B;\r\n              if (formatAsRGBA) {\r\n                imageDataArray[j++] = 255;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n          throw new Error('Unsupported color mode');\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  // We cap the amount of memory used by jpeg-js to avoid unexpected OOMs from untrusted content.\r\n  var totalBytesAllocated = 0;\r\n  var maxMemoryUsageBytes = 0;\r\n  function requestMemoryAllocation(increaseAmount = 0) {\r\n    var totalMemoryImpactBytes = totalBytesAllocated + increaseAmount;\r\n    if (totalMemoryImpactBytes > maxMemoryUsageBytes) {\r\n      var exceededAmount = Math.ceil((totalMemoryImpactBytes - maxMemoryUsageBytes) / 1024 / 1024);\r\n      throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${exceededAmount}MB`);\r\n    }\r\n\r\n    totalBytesAllocated = totalMemoryImpactBytes;\r\n  }\r\n\r\n  constructor.resetMaxMemoryUsage = function (maxMemoryUsageBytes_) {\r\n    totalBytesAllocated = 0;\r\n    maxMemoryUsageBytes = maxMemoryUsageBytes_;\r\n  };\r\n\r\n  constructor.getBytesAllocated = function () {\r\n    return totalBytesAllocated;\r\n  };\r\n\r\n  constructor.requestMemoryAllocation = requestMemoryAllocation;\r\n\r\n  return constructor;\r\n})();\r\n\r\nfunction decode(jpegData, userOpts = {}) {\r\n  var defaultOpts = {\r\n    // \"undefined\" means \"Choose whether to transform colors based on the image\u2019s color model.\"\r\n    colorTransform: undefined,\r\n    useTArray: false,\r\n    formatAsRGBA: true,\r\n    tolerantDecoding: true,\r\n    maxResolutionInMP: 100, // Don't decode more than 100 megapixels\r\n    maxMemoryUsageInMB: 512, // Don't decode if memory footprint is more than 512MB\r\n  };\r\n\r\n  var opts = {...defaultOpts, ...userOpts};\r\n  var arr = new Uint8Array(jpegData);\r\n  var decoder = new JpegImage();\r\n  decoder.opts = opts;\r\n  // If this constructor ever supports async decoding this will need to be done differently.\r\n  // Until then, treating as singleton limit is fine.\r\n  JpegImage.resetMaxMemoryUsage(opts.maxMemoryUsageInMB * 1024 * 1024);\r\n  decoder.parse(arr);\r\n\r\n  var channels = (opts.formatAsRGBA) ? 4 : 3;\r\n  var bytesNeeded = decoder.width * decoder.height * channels;\r\n  try {\r\n    JpegImage.requestMemoryAllocation(bytesNeeded);\r\n    var image = {\r\n      width: decoder.width,\r\n      height: decoder.height,\r\n      exifBuffer: decoder.exifBuffer,\r\n      data: opts.useTArray ?\r\n        new Uint8Array(bytesNeeded) :\r\n        Buffer.alloc(bytesNeeded)\r\n    };\r\n    if(decoder.comments.length > 0) {\r\n      image[\"comments\"] = decoder.comments;\r\n    }\r\n  } catch (err) {\r\n    if (err instanceof RangeError) {\r\n      throw new Error(\"Could not allocate enough memory for the image. \" +\r\n                      \"Required: \" + bytesNeeded);\r\n    } \r\n    \r\n    if (err instanceof ReferenceError) {\r\n      if (err.message === \"Buffer is not defined\") {\r\n        throw new Error(\"Buffer is not globally defined in this environment. \" +\r\n                        \"Consider setting useTArray to true\");\r\n      }\r\n    }\r\n    throw err;\r\n  }\r\n\r\n  decoder.copyToImageData(image, opts.formatAsRGBA);\r\n\r\n  return image;\r\n}\r\n\r\nexport default decode;\r\nexport { decode };\r\n", "import decodeJpeg from \"./lib/vendor/jpeg-decoder.js\";\r\n\r\nconst MAX_DIMENSION = 96;\r\nconst TARGET_SAMPLE_COUNT = 2400;\r\n\r\ntype SupportedFormat = \"jpeg\" | \"jpg\" | \"pjpeg\";\r\n\r\ninterface DecodedImage {\r\n  width: number;\r\n  height: number;\r\n  data: Uint8ClampedArray;\r\n}\r\n\r\nclass UnsupportedImageFormatError extends Error {\r\n  constructor(format: string) {\r\n    super(`Unsupported image format: ${format}`);\r\n    this.name = \"UnsupportedImageFormatError\";\r\n  }\r\n}\r\n\r\ninterface PaletteStop {\r\n  gradient: string;\r\n  colors: string[];\r\n}\r\n\r\ninterface ThemeTokens {\r\n  primaryColor: string;\r\n  primaryColorDark: string;\r\n}\r\n\r\ninterface PaletteResponse {\r\n  source: string;\r\n  baseColor: string;\r\n  averageColor: string;\r\n  accentColor: string;\r\n  contrastColor: string;\r\n  gradients: Record<\"light\" | \"dark\", PaletteStop>;\r\n  tokens: Record<\"light\" | \"dark\", ThemeTokens>;\r\n}\r\n\r\ninterface HslColor {\r\n  h: number;\r\n  s: number;\r\n  l: number;\r\n}\r\n\r\ninterface RgbColor {\r\n  r: number;\r\n  g: number;\r\n  b: number;\r\n}\r\n\r\ninterface AnalyzedColors {\r\n  average: HslColor;\r\n  accent: HslColor;\r\n}\r\n\r\nfunction clamp(value: number, min: number, max: number): number {\r\n  return Math.min(Math.max(value, min), max);\r\n}\r\n\r\nfunction componentToHex(value: number): string {\r\n  const clamped = clamp(Math.round(value), 0, 255);\r\n  return clamped.toString(16).padStart(2, \"0\");\r\n}\r\n\r\nfunction rgbToHex({ r, g, b }: RgbColor): string {\r\n  return `#${componentToHex(r)}${componentToHex(g)}${componentToHex(b)}`;\r\n}\r\n\r\nfunction rgbToHsl(r: number, g: number, b: number): HslColor {\r\n  const rNorm = clamp(r / 255, 0, 1);\r\n  const gNorm = clamp(g / 255, 0, 1);\r\n  const bNorm = clamp(b / 255, 0, 1);\r\n\r\n  const max = Math.max(rNorm, gNorm, bNorm);\r\n  const min = Math.min(rNorm, gNorm, bNorm);\r\n  const delta = max - min;\r\n\r\n  let h = 0;\r\n  if (delta !== 0) {\r\n    if (max === rNorm) {\r\n      h = ((gNorm - bNorm) / delta) % 6;\r\n    } else if (max === gNorm) {\r\n      h = (bNorm - rNorm) / delta + 2;\r\n    } else {\r\n      h = (rNorm - gNorm) / delta + 4;\r\n    }\r\n    h *= 60;\r\n    if (h < 0) {\r\n      h += 360;\r\n    }\r\n  }\r\n\r\n  const l = (max + min) / 2;\r\n  const s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\r\n\r\n  return { h, s, l };\r\n}\r\n\r\nfunction hueToRgb(p: number, q: number, t: number): number {\r\n  if (t < 0) t += 1;\r\n  if (t > 1) t -= 1;\r\n  if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n  if (t < 1 / 2) return q;\r\n  if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n  return p;\r\n}\r\n\r\nfunction hslToRgb(h: number, s: number, l: number): RgbColor {\r\n  const saturation = clamp(s, 0, 1);\r\n  const lightness = clamp(l, 0, 1);\r\n\r\n  const normalizedHue = ((h % 360) + 360) % 360 / 360;\r\n\r\n  if (saturation === 0) {\r\n    const value = lightness * 255;\r\n    return { r: value, g: value, b: value };\r\n  }\r\n\r\n  const q = lightness < 0.5\r\n    ? lightness * (1 + saturation)\r\n    : lightness + saturation - lightness * saturation;\r\n  const p = 2 * lightness - q;\r\n\r\n  const r = hueToRgb(p, q, normalizedHue + 1 / 3) * 255;\r\n  const g = hueToRgb(p, q, normalizedHue) * 255;\r\n  const b = hueToRgb(p, q, normalizedHue - 1 / 3) * 255;\r\n\r\n  return { r, g, b };\r\n}\r\n\r\nfunction hslToHex(color: HslColor): string {\r\n  const rgb = hslToRgb(color.h, color.s, color.l);\r\n  return rgbToHex(rgb);\r\n}\r\n\r\nfunction relativeLuminance(r: number, g: number, b: number): number {\r\n  const normalize = (value: number) => {\r\n    const channel = clamp(value / 255, 0, 1);\r\n    return channel <= 0.03928\r\n      ? channel / 12.92\r\n      : Math.pow((channel + 0.055) / 1.055, 2.4);\r\n  };\r\n\r\n  const rLin = normalize(r);\r\n  const gLin = normalize(g);\r\n  const bLin = normalize(b);\r\n\r\n  return 0.2126 * rLin + 0.7152 * gLin + 0.0722 * bLin;\r\n}\r\n\r\nfunction pickContrastColor(color: RgbColor): string {\r\n  const luminance = relativeLuminance(color.r, color.g, color.b);\r\n  return luminance > 0.45 ? \"#1f2937\" : \"#f8fafc\";\r\n}\r\n\r\nfunction adjustSaturation(base: number, factor: number, offset = 0): number {\r\n  return clamp(base * factor + offset, 0, 1);\r\n}\r\n\r\nfunction adjustLightness(base: number, offset: number, factor = 1): number {\r\n  return clamp(base * factor + offset, 0, 1);\r\n}\r\n\r\nfunction analyzeImageColors(image: DecodedImage): AnalyzedColors {\r\n  const { data } = image;\r\n  const totalPixels = data.length / 4;\r\n  const step = Math.max(1, Math.floor(totalPixels / TARGET_SAMPLE_COUNT));\r\n\r\n  let totalR = 0;\r\n  let totalG = 0;\r\n  let totalB = 0;\r\n  let count = 0;\r\n\r\n  let accent: { color: HslColor; score: number } | null = null;\r\n\r\n  for (let index = 0; index < data.length; index += step * 4) {\r\n    const alpha = data[index + 3];\r\n    if (alpha < 48) {\r\n      continue;\r\n    }\r\n\r\n    const r = data[index];\r\n    const g = data[index + 1];\r\n    const b = data[index + 2];\r\n\r\n    totalR += r;\r\n    totalG += g;\r\n    totalB += b;\r\n    count++;\r\n\r\n    const hsl = rgbToHsl(r, g, b);\r\n    const vibrance = hsl.s;\r\n    const balance = 1 - Math.abs(hsl.l - 0.5);\r\n    const score = vibrance * 0.65 + balance * 0.35;\r\n\r\n    if (!accent || score > accent.score) {\r\n      accent = { color: hsl, score };\r\n    }\r\n  }\r\n\r\n  if (count === 0) {\r\n    throw new Error(\"No opaque pixels available for analysis\");\r\n  }\r\n\r\n  const averageR = totalR / count;\r\n  const averageG = totalG / count;\r\n  const averageB = totalB / count;\r\n  const average = rgbToHsl(averageR, averageG, averageB);\r\n\r\n  const accentColor = accent ? accent.color : average;\r\n\r\n  return {\r\n    average,\r\n    accent: accentColor,\r\n  };\r\n}\r\n\r\nfunction buildGradientStops(accent: HslColor): { light: PaletteStop; dark: PaletteStop } {\r\n  const lightColors = [\r\n    hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.4, 0.08), l: adjustLightness(accent.l, 0.42, 0.52) }),\r\n    hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.52, 0.05), l: adjustLightness(accent.l, 0.26, 0.62) }),\r\n    hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.65), l: adjustLightness(accent.l, 0.12, 0.72) }),\r\n  ];\r\n\r\n  const darkColors = [\r\n    hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.55, 0.04), l: adjustLightness(accent.l, 0.14, 0.38) }),\r\n    hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.62, 0.02), l: adjustLightness(accent.l, 0.04, 0.3) }),\r\n    hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.72), l: adjustLightness(accent.l, -0.04, 0.22) }),\r\n  ];\r\n\r\n  return {\r\n    light: {\r\n      colors: lightColors,\r\n      gradient: `linear-gradient(140deg, ${lightColors[0]} 0%, ${lightColors[1]} 45%, ${lightColors[2]} 100%)`,\r\n    },\r\n    dark: {\r\n      colors: darkColors,\r\n      gradient: `linear-gradient(135deg, ${darkColors[0]} 0%, ${darkColors[1]} 55%, ${darkColors[2]} 100%)`,\r\n    },\r\n  };\r\n}\r\n\r\nfunction buildThemeTokens(accent: HslColor): Record<\"light\" | \"dark\", ThemeTokens> {\r\n  return {\r\n    light: {\r\n      primaryColor: hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.6, 0.06), l: adjustLightness(accent.l, 0.22, 0.6) }),\r\n      primaryColorDark: hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.72, 0.02), l: adjustLightness(accent.l, 0.06, 0.52) }),\r\n    },\r\n    dark: {\r\n      primaryColor: hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.58, 0.04), l: adjustLightness(accent.l, 0.16, 0.42) }),\r\n      primaryColorDark: hslToHex({ h: accent.h, s: adjustSaturation(accent.s, 0.68), l: adjustLightness(accent.l, 0.02, 0.32) }),\r\n    },\r\n  };\r\n}\r\n\r\nfunction resizeImage(image: DecodedImage): DecodedImage {\r\n  const maxSide = Math.max(image.width, image.height);\r\n  if (maxSide <= MAX_DIMENSION) {\r\n    return image;\r\n  }\r\n\r\n  const scale = MAX_DIMENSION / maxSide;\r\n  const width = Math.max(1, Math.round(image.width * scale));\r\n  const height = Math.max(1, Math.round(image.height * scale));\r\n  const resized = new Uint8ClampedArray(width * height * 4);\r\n\r\n  for (let y = 0; y < height; y += 1) {\r\n    const srcY = Math.min(image.height - 1, Math.floor(y / scale));\r\n    for (let x = 0; x < width; x += 1) {\r\n      const srcX = Math.min(image.width - 1, Math.floor(x / scale));\r\n      const srcIndex = (srcY * image.width + srcX) * 4;\r\n      const destIndex = (y * width + x) * 4;\r\n\r\n      resized[destIndex] = image.data[srcIndex];\r\n      resized[destIndex + 1] = image.data[srcIndex + 1];\r\n      resized[destIndex + 2] = image.data[srcIndex + 2];\r\n      resized[destIndex + 3] = image.data[srcIndex + 3];\r\n    }\r\n  }\r\n\r\n  return {\r\n    width,\r\n    height,\r\n    data: resized,\r\n  };\r\n}\r\n\r\nfunction decodeImage(arrayBuffer: ArrayBuffer, contentType: string): DecodedImage {\r\n  const subtype = contentType.split(\"/\")[1]?.split(\";\")[0]?.toLowerCase() ?? \"\";\r\n  const supported: SupportedFormat[] = [\"jpeg\", \"jpg\", \"pjpeg\"];\r\n  if (!supported.includes(subtype as SupportedFormat)) {\r\n    throw new UnsupportedImageFormatError(subtype);\r\n  }\r\n\r\n  const bytes = new Uint8Array(arrayBuffer);\r\n  const decoded = decodeJpeg(bytes, {\r\n    useTArray: true,\r\n    formatAsRGBA: true,\r\n  });\r\n\r\n  const image: DecodedImage = {\r\n    width: decoded.width,\r\n    height: decoded.height,\r\n    data: new Uint8ClampedArray(decoded.data),\r\n  };\r\n\r\n  return resizeImage(image);\r\n}\r\n\r\nasync function buildPalette(arrayBuffer: ArrayBuffer, contentType: string): Promise<PaletteResponse> {\r\n  const imageData = decodeImage(arrayBuffer, contentType);\r\n  const analyzed = analyzeImageColors(imageData);\r\n  const gradientStops = buildGradientStops(analyzed.accent);\r\n  const tokens = buildThemeTokens(analyzed.accent);\r\n\r\n  const accentRgb = hslToRgb(analyzed.accent.h, analyzed.accent.s, analyzed.accent.l);\r\n\r\n  return {\r\n    source: \"\",\r\n    baseColor: hslToHex(analyzed.accent),\r\n    averageColor: hslToHex(analyzed.average),\r\n    accentColor: hslToHex(analyzed.accent),\r\n    contrastColor: pickContrastColor(accentRgb),\r\n    gradients: {\r\n      light: gradientStops.light,\r\n      dark: gradientStops.dark,\r\n    },\r\n    tokens,\r\n  };\r\n}\r\n\r\nfunction createCorsHeaders(init?: HeadersInit): Headers {\r\n  const headers = new Headers(init);\r\n  headers.set(\"Access-Control-Allow-Origin\", \"*\");\r\n  return headers;\r\n}\r\n\r\nfunction createJsonHeaders(status: number): Headers {\r\n  const headers = createCorsHeaders({\r\n    \"Content-Type\": \"application/json; charset=utf-8\",\r\n  });\r\n  headers.set(\"Cache-Control\", status === 200 ? \"public, max-age=3600\" : \"no-store\");\r\n  return headers;\r\n}\r\n\r\nfunction handleOptions(): Response {\r\n  return new Response(null, {\r\n    status: 204,\r\n    headers: {\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Access-Control-Allow-Methods\": \"GET,OPTIONS\",\r\n      \"Access-Control-Allow-Headers\": \"*\",\r\n      \"Access-Control-Max-Age\": \"86400\",\r\n    },\r\n  });\r\n}\r\n\r\nexport async function onRequest({ request }: { request: Request }): Promise<Response> {\r\n  if (request.method === \"OPTIONS\") {\r\n    return handleOptions();\r\n  }\r\n\r\n  if (request.method !== \"GET\") {\r\n    return new Response(JSON.stringify({ error: \"Method not allowed\" }), {\r\n      status: 405,\r\n      headers: createJsonHeaders(405),\r\n    });\r\n  }\r\n\r\n  const url = new URL(request.url);\r\n  const imageParam = url.searchParams.get(\"image\") ?? url.searchParams.get(\"url\");\r\n\r\n  if (!imageParam) {\r\n    return new Response(JSON.stringify({ error: \"Missing image parameter\" }), {\r\n      status: 400,\r\n      headers: createJsonHeaders(400),\r\n    });\r\n  }\r\n\r\n  let target: URL;\r\n  try {\r\n    target = new URL(imageParam);\r\n  } catch {\r\n    return new Response(JSON.stringify({ error: \"Invalid image URL\" }), {\r\n      status: 400,\r\n      headers: createJsonHeaders(400),\r\n    });\r\n  }\r\n\r\n  const cache = caches.default;\r\n  const cacheKey = new Request(request.url, request);\r\n  const cachedResponse = await cache.match(cacheKey);\r\n  if (cachedResponse) {\r\n    return cachedResponse;\r\n  }\r\n\r\n  let upstream: Response;\r\n  try {\r\n    upstream = await fetch(target.toString(), {\r\n      cf: {\r\n        cacheTtl: 3600,\r\n        cacheEverything: true,\r\n        image: {\r\n          width: MAX_DIMENSION,\r\n          height: MAX_DIMENSION,\r\n          fit: \"scale-down\",\r\n          quality: 85,\r\n          format: \"jpeg\",\r\n        },\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.warn(\"Image resizing fetch failed, falling back to original\", error);\r\n    upstream = await fetch(target.toString(), {\r\n      cf: {\r\n        cacheTtl: 3600,\r\n        cacheEverything: true,\r\n      },\r\n    });\r\n  }\r\n\r\n  if (!upstream.ok) {\r\n    return new Response(JSON.stringify({ error: `Upstream request failed with status ${upstream.status}` }), {\r\n      status: upstream.status,\r\n      headers: createJsonHeaders(upstream.status),\r\n    });\r\n  }\r\n\r\n  const contentType = upstream.headers.get(\"content-type\") ?? \"\";\r\n  if (!contentType.startsWith(\"image/\")) {\r\n    return new Response(JSON.stringify({ error: \"Unsupported content type\" }), {\r\n      status: 415,\r\n      headers: createJsonHeaders(415),\r\n    });\r\n  }\r\n\r\n  const buffer = await upstream.arrayBuffer();\r\n\r\n  try {\r\n    const palette = await buildPalette(buffer, contentType);\r\n    palette.source = target.toString();\r\n\r\n    const response = new Response(JSON.stringify(palette), {\r\n      status: 200,\r\n      headers: createJsonHeaders(200),\r\n    });\r\n\r\n    try {\r\n      await cache.put(cacheKey, response.clone());\r\n    } catch (cacheError) {\r\n      console.warn(\"Failed to cache palette response\", cacheError);\r\n    }\r\n\r\n    return response;\r\n  } catch (error) {\r\n    if (error instanceof UnsupportedImageFormatError) {\r\n      return new Response(JSON.stringify({ error: error.message }), {\r\n        status: 415,\r\n        headers: createJsonHeaders(415),\r\n      });\r\n    }\r\n    console.error(\"Palette generation failed\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to analyze image\" }), {\r\n      status: 500,\r\n      headers: createJsonHeaders(500),\r\n    });\r\n  }\r\n}\r\n\r\n", "const API_BASE_URL = \"https://music-dl.sayqz.com/api/\";\r\nconst KUWO_HOST_PATTERN = /(^|\\\\.)kuwo\\\\.cn$/i;\r\nconst SAFE_RESPONSE_HEADERS = [\"content-type\", \"cache-control\", \"accept-ranges\", \"content-length\", \"content-range\", \"etag\", \"last-modified\", \"expires\"];\r\n\r\nfunction createCorsHeaders(init?: Headers): Headers {\r\n  const headers = new Headers();\r\n  if (init) {\r\n    for (const [key, value] of init.entries()) {\r\n      if (SAFE_RESPONSE_HEADERS.includes(key.toLowerCase())) {\r\n        headers.set(key, value);\r\n      }\r\n    }\r\n  }\r\n  if (!headers.has(\"Cache-Control\")) {\r\n    headers.set(\"Cache-Control\", \"no-store\");\r\n  }\r\n  headers.set(\"Access-Control-Allow-Origin\", \"*\");\r\n  return headers;\r\n}\r\n\r\nfunction handleOptions(): Response {\r\n  return new Response(null, {\r\n    status: 204,\r\n    headers: {\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Access-Control-Allow-Methods\": \"GET,HEAD,OPTIONS\",\r\n      \"Access-Control-Allow-Headers\": \"*\",\r\n      \"Access-Control-Max-Age\": \"86400\",\r\n    },\r\n  });\r\n}\r\n\r\nfunction isAllowedKuwoHost(hostname: string): boolean {\r\n  if (!hostname) return false;\r\n  return KUWO_HOST_PATTERN.test(hostname);\r\n}\r\n\r\nfunction normalizeKuwoUrl(rawUrl: string): URL | null {\r\n  try {\r\n    const parsed = new URL(rawUrl);\r\n    if (!isAllowedKuwoHost(parsed.hostname)) {\r\n      return null;\r\n    }\r\n    if (parsed.protocol !== \"http:\" && parsed.protocol !== \"https:\") {\r\n      return null;\r\n    }\r\n    parsed.protocol = \"http:\";\r\n    return parsed;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function proxyKuwoAudio(targetUrl: string, request: Request): Promise<Response> {\r\n  const normalized = normalizeKuwoUrl(targetUrl);\r\n  if (!normalized) {\r\n    return new Response(\"Invalid target\", { status: 400 });\r\n  }\r\n\r\n  const init: RequestInit = {\r\n    method: request.method,\r\n    headers: {\r\n      \"User-Agent\": request.headers.get(\"User-Agent\") ?? \"Mozilla/5.0\",\r\n      \"Referer\": \"https://www.kuwo.cn/\",\r\n    },\r\n  };\r\n\r\n  const rangeHeader = request.headers.get(\"Range\");\r\n  if (rangeHeader) {\r\n    (init.headers as Record<string, string>)[\"Range\"] = rangeHeader;\r\n  }\r\n\r\n  const upstream = await fetch(normalized.toString(), init);\r\n  const headers = createCorsHeaders(upstream.headers);\r\n  if (!headers.has(\"Cache-Control\")) {\r\n    headers.set(\"Cache-Control\", \"public, max-age=3600\");\r\n  }\r\n\r\n  return new Response(upstream.body, {\r\n    status: upstream.status,\r\n    statusText: upstream.statusText,\r\n    headers,\r\n  });\r\n}\r\n\r\nasync function proxyApiRequest(url: URL, request: Request): Promise<Response> {\r\n  const apiUrl = new URL(API_BASE_URL);\r\n\r\n  // Map old parameter names to new API format\r\n  const paramMapping: Record<string, string> = {\r\n    \"types\": \"type\",\r\n    \"name\": \"keyword\",\r\n    \"count\": \"limit\",\r\n    \"pages\": \"page\"\r\n  };\r\n\r\n  url.searchParams.forEach((value, key) => {\r\n    if (key === \"target\" || key === \"callback\" || key === \"s\") {\r\n      // Skip target, callback, and signature parameters\r\n      return;\r\n    }\r\n    // Use mapped parameter name if exists, otherwise use original\r\n    const mappedKey = paramMapping[key] || key;\r\n    apiUrl.searchParams.set(mappedKey, value);\r\n  });\r\n\r\n  if (!apiUrl.searchParams.has(\"type\")) {\r\n    return new Response(\"Missing type parameter\", { status: 400 });\r\n  }\r\n\r\n  // Special handling for realurl type: get the real redirected URL\r\n  const requestType = apiUrl.searchParams.get(\"type\");\r\n  if (requestType === \"realurl\") {\r\n    // Change type to 'url' to get the audio URL from upstream API\r\n    apiUrl.searchParams.set(\"type\", \"url\");\r\n\r\n    try {\r\n      // Fetch with manual redirect to capture the Location header\r\n      const upstream = await fetch(apiUrl.toString(), {\r\n        headers: {\r\n          \"User-Agent\": request.headers.get(\"User-Agent\") ?? \"Mozilla/5.0\",\r\n        },\r\n        redirect: \"manual\",\r\n      });\r\n\r\n      // Get the real URL from Location header\r\n      const realUrl = upstream.headers.get(\"Location\");\r\n\r\n      if (!realUrl) {\r\n        return new Response(JSON.stringify({\r\n          code: 500,\r\n          message: \"Failed to get real audio URL\",\r\n          data: null\r\n        }), {\r\n          status: 500,\r\n          headers: createCorsHeaders(new Headers({\r\n            \"Content-Type\": \"application/json; charset=utf-8\"\r\n          })),\r\n        });\r\n      }\r\n\r\n      // Return the real URL as JSON\r\n      const headers = createCorsHeaders(new Headers());\r\n      headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\r\n\r\n      return new Response(JSON.stringify({\r\n        code: 200,\r\n        message: \"success\",\r\n        data: {\r\n          url: realUrl\r\n        }\r\n      }), {\r\n        status: 200,\r\n        headers,\r\n      });\r\n    } catch (error) {\r\n      return new Response(JSON.stringify({\r\n        code: 500,\r\n        message: error instanceof Error ? error.message : \"Unknown error\",\r\n        data: null\r\n      }), {\r\n        status: 500,\r\n        headers: createCorsHeaders(new Headers({\r\n          \"Content-Type\": \"application/json; charset=utf-8\"\r\n        })),\r\n      });\r\n    }\r\n  }\r\n\r\n  const upstream = await fetch(apiUrl.toString(), {\r\n    headers: {\r\n      \"User-Agent\": request.headers.get(\"User-Agent\") ?? \"Mozilla/5.0\",\r\n      \"Accept\": \"application/json\",\r\n    },\r\n  });\r\n\r\n  const headers = createCorsHeaders(upstream.headers);\r\n  if (!headers.has(\"Content-Type\")) {\r\n    headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\r\n  }\r\n\r\n  return new Response(upstream.body, {\r\n    status: upstream.status,\r\n    statusText: upstream.statusText,\r\n    headers,\r\n  });\r\n}\r\n\r\nexport async function onRequest({ request }: { request: Request }): Promise<Response> {\r\n  if (request.method === \"OPTIONS\") {\r\n    return handleOptions();\r\n  }\r\n\r\n  if (request.method !== \"GET\" && request.method !== \"HEAD\") {\r\n    return new Response(\"Method not allowed\", { status: 405 });\r\n  }\r\n\r\n  const url = new URL(request.url);\r\n  const target = url.searchParams.get(\"target\");\r\n\r\n  if (target) {\r\n    return proxyKuwoAudio(target, request);\r\n  }\r\n\r\n  return proxyApiRequest(url, request);\r\n}\r\n", "const PUBLIC_PATH_PATTERNS = [/^\\/login(?:\\/|$)/, /^\\/api\\/login(?:\\/|$)/];\r\nconst PUBLIC_FILE_EXTENSIONS = new Set([\r\n  \".css\",\r\n  \".js\",\r\n  \".png\",\r\n  \".svg\",\r\n  \".jpg\",\r\n  \".jpeg\",\r\n  \".gif\",\r\n  \".webp\",\r\n  \".ico\",\r\n  \".txt\",\r\n  \".map\",\r\n  \".json\",\r\n  \".woff\",\r\n  \".woff2\",\r\n]);\r\n\r\nfunction hasPublicExtension(pathname: string): boolean {\r\n  const lastDotIndex = pathname.lastIndexOf(\".\");\r\n  if (lastDotIndex === -1) {\r\n    return false;\r\n  }\r\n  const extension = pathname.slice(lastDotIndex).toLowerCase();\r\n  return PUBLIC_FILE_EXTENSIONS.has(extension);\r\n}\r\n\r\nfunction isPublicPath(pathname: string): boolean {\r\n  return (\r\n    PUBLIC_PATH_PATTERNS.some((pattern) => pattern.test(pathname)) ||\r\n    hasPublicExtension(pathname)\r\n  );\r\n}\r\n\r\nexport async function onRequest(context: any) {\r\n  const { request, env } = context;\r\n  const password = env.PASSWORD;\r\n\r\n  if (typeof password !== \"string\") {\r\n    return context.next();\r\n  }\r\n\r\n  const url = new URL(request.url);\r\n  const pathname = url.pathname;\r\n  if (isPublicPath(pathname)) {\r\n    return context.next();\r\n  }\r\n\r\n  const cookieHeader = request.headers.get(\"Cookie\") || \"\";\r\n  const cookies: Record<string, string> = {};\r\n  cookieHeader.split(\";\").forEach((part) => {\r\n    const separatorIndex = part.indexOf(\"=\");\r\n    if (separatorIndex === -1) {\r\n      return;\r\n    }\r\n    const key = part.slice(0, separatorIndex).trim();\r\n    const value = part.slice(separatorIndex + 1).trim();\r\n    if (key) {\r\n      cookies[key] = value;\r\n    }\r\n  });\r\n\r\n  if (cookies.auth && cookies.auth === btoa(password)) {\r\n    return context.next();\r\n  }\r\n\r\n  const loginUrl = new URL(\"/login\", url);\r\n  return Response.redirect(loginUrl.toString(), 302);\r\n}\r\n", "import { onRequestPost as __api_login_ts_onRequestPost } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\functions\\\\api\\\\login.ts\"\nimport { onRequest as __api_storage_ts_onRequest } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\functions\\\\api\\\\storage.ts\"\nimport { onRequest as __palette_ts_onRequest } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\functions\\\\palette.ts\"\nimport { onRequest as __proxy_ts_onRequest } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\functions\\\\proxy.ts\"\nimport { onRequest as ___middleware_ts_onRequest } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\functions\\\\_middleware.ts\"\n\nexport const routes = [\n    {\n      routePath: \"/api/login\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_login_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/storage\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_storage_ts_onRequest],\n    },\n  {\n      routePath: \"/palette\",\n      mountPath: \"/\",\n      method: \"\",\n      middlewares: [],\n      modules: [__palette_ts_onRequest],\n    },\n  {\n      routePath: \"/proxy\",\n      mountPath: \"/\",\n      method: \"\",\n      middlewares: [],\n      modules: [__proxy_ts_onRequest],\n    },\n  {\n      routePath: \"/\",\n      mountPath: \"/\",\n      method: \"\",\n      middlewares: [___middleware_ts_onRequest],\n      modules: [],\n    },\n  ]", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import { match } from \"path-to-regexp\";\r\n\r\n//note: this explicitly does not include the * character, as pages requires this\r\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\r\n\r\ntype HTTPMethod =\r\n\t| \"HEAD\"\r\n\t| \"OPTIONS\"\r\n\t| \"GET\"\r\n\t| \"POST\"\r\n\t| \"PUT\"\r\n\t| \"PATCH\"\r\n\t| \"DELETE\";\r\n\r\n/* TODO: Grab these from @cloudflare/workers-types instead */\r\ntype Params<P extends string = string> = Record<P, string | string[]>;\r\n\r\ntype EventContext<Env, P extends string, Data> = {\r\n\trequest: Request;\r\n\tfunctionPath: string;\r\n\twaitUntil: (promise: Promise<unknown>) => void;\r\n\tpassThroughOnException: () => void;\r\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\r\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\r\n\tparams: Params<P>;\r\n\tdata: Data;\r\n};\r\n\r\ndeclare type PagesFunction<\r\n\tEnv = unknown,\r\n\tP extends string = string,\r\n\tData extends Record<string, unknown> = Record<string, unknown>,\r\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\r\n/* end @cloudflare/workers-types */\r\n\r\ntype RouteHandler = {\r\n\troutePath: string;\r\n\tmountPath: string;\r\n\tmethod?: HTTPMethod;\r\n\tmodules: PagesFunction[];\r\n\tmiddlewares: PagesFunction[];\r\n};\r\n\r\n// inject `routes` via ESBuild\r\ndeclare const routes: RouteHandler[];\r\n// define `__FALLBACK_SERVICE__` via ESBuild\r\ndeclare const __FALLBACK_SERVICE__: string;\r\n\r\n// expect an ASSETS fetcher binding pointing to the asset-server stage\r\ntype FetchEnv = {\r\n\t[name: string]: { fetch: typeof fetch };\r\n\tASSETS: { fetch: typeof fetch };\r\n};\r\n\r\ntype WorkerContext = {\r\n\twaitUntil: (promise: Promise<unknown>) => void;\r\n\tpassThroughOnException: () => void;\r\n};\r\n\r\nfunction* executeRequest(request: Request) {\r\n\tconst requestPath = new URL(request.url).pathname;\r\n\r\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\r\n\tfor (const route of [...routes].reverse()) {\r\n\t\tif (route.method && route.method !== request.method) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\r\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\r\n\t\t\tend: false,\r\n\t\t});\r\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\r\n\t\t\tend: false,\r\n\t\t});\r\n\t\tconst matchResult = routeMatcher(requestPath);\r\n\t\tconst mountMatchResult = mountMatcher(requestPath);\r\n\t\tif (matchResult && mountMatchResult) {\r\n\t\t\tfor (const handler of route.middlewares.flat()) {\r\n\t\t\t\tyield {\r\n\t\t\t\t\thandler,\r\n\t\t\t\t\tparams: matchResult.params as Params,\r\n\t\t\t\t\tpath: mountMatchResult.path,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Then look for the first exact route match and execute its \"modules\"\r\n\tfor (const route of routes) {\r\n\t\tif (route.method && route.method !== request.method) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\r\n\t\t\tend: true,\r\n\t\t});\r\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\r\n\t\t\tend: false,\r\n\t\t});\r\n\t\tconst matchResult = routeMatcher(requestPath);\r\n\t\tconst mountMatchResult = mountMatcher(requestPath);\r\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\r\n\t\t\tfor (const handler of route.modules.flat()) {\r\n\t\t\t\tyield {\r\n\t\t\t\t\thandler,\r\n\t\t\t\t\tparams: matchResult.params as Params,\r\n\t\t\t\t\tpath: matchResult.path,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tasync fetch(\r\n\t\toriginalRequest: Request,\r\n\t\tenv: FetchEnv,\r\n\t\tworkerContext: WorkerContext\r\n\t) {\r\n\t\tlet request = originalRequest;\r\n\t\tconst handlerIterator = executeRequest(request);\r\n\t\tlet data = {}; // arbitrary data the user can set between functions\r\n\t\tlet isFailOpen = false;\r\n\r\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\r\n\t\t\tif (input !== undefined) {\r\n\t\t\t\tlet url = input;\r\n\t\t\t\tif (typeof input === \"string\") {\r\n\t\t\t\t\turl = new URL(input, request.url).toString();\r\n\t\t\t\t}\r\n\t\t\t\trequest = new Request(url, init);\r\n\t\t\t}\r\n\r\n\t\t\tconst result = handlerIterator.next();\r\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\r\n\t\t\tif (result.done === false) {\r\n\t\t\t\tconst { handler, params, path } = result.value;\r\n\t\t\t\tconst context = {\r\n\t\t\t\t\trequest: new Request(request.clone()),\r\n\t\t\t\t\tfunctionPath: path,\r\n\t\t\t\t\tnext,\r\n\t\t\t\t\tparams,\r\n\t\t\t\t\tget data() {\r\n\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tset data(value) {\r\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\r\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\r\n\t\t\t\t\t\tdata = value;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tenv,\r\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\r\n\t\t\t\t\tpassThroughOnException: () => {\r\n\t\t\t\t\t\tisFailOpen = true;\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst response = await handler(context);\r\n\r\n\t\t\t\tif (!(response instanceof Response)) {\r\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn cloneResponse(response);\r\n\t\t\t} else if (__FALLBACK_SERVICE__) {\r\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\r\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\r\n\t\t\t\treturn cloneResponse(response);\r\n\t\t\t} else {\r\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\r\n\t\t\t\tconst response = await fetch(request);\r\n\t\t\t\treturn cloneResponse(response);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\treturn await next();\r\n\t\t} catch (error) {\r\n\t\t\tif (isFailOpen) {\r\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\r\n\t\t\t\treturn cloneResponse(response);\r\n\t\t\t}\r\n\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n};\r\n\r\n// This makes a Response mutable\r\nconst cloneResponse = (response: Response) =>\r\n\t// https://fetch.spec.whatwg.org/#null-body-status\r\n\tnew Response(\r\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\r\n\t\tresponse\r\n\t);\r\n", "import type { Middleware } from \"./common\";\r\n\r\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\r\n\ttry {\r\n\t\treturn await middlewareCtx.next(request, env);\r\n\t} finally {\r\n\t\ttry {\r\n\t\t\tif (request.body !== null && !request.bodyUsed) {\r\n\t\t\t\tconst reader = request.body.getReader();\r\n\t\t\t\twhile (!(await reader.read()).done) {}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default drainBody;\r\n", "import type { Middleware } from \"./common\";\r\n\r\ninterface JsonError {\r\n\tmessage?: string;\r\n\tname?: string;\r\n\tstack?: string;\r\n\tcause?: JsonError;\r\n}\r\n\r\nfunction reduceError(e: any): JsonError {\r\n\treturn {\r\n\t\tname: e?.name,\r\n\t\tmessage: e?.message ?? String(e),\r\n\t\tstack: e?.stack,\r\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\r\n\t};\r\n}\r\n\r\n// See comment in `bundle.ts` for details on why this is needed\r\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\r\n\ttry {\r\n\t\treturn await middlewareCtx.next(request, env);\r\n\t} catch (e: any) {\r\n\t\tconst error = reduceError(e);\r\n\t\treturn Response.json(error, {\r\n\t\t\tstatus: 500,\r\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport default jsonError;\r\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\r\n// TODO: allow dispatching more events?\r\nexport type Dispatcher = (\r\n\ttype: \"scheduled\",\r\n\tinit: { cron?: string }\r\n) => Awaitable<void>;\r\n\r\nexport type IncomingRequest = Request<\r\n\tunknown,\r\n\tIncomingRequestCfProperties<unknown>\r\n>;\r\n\r\nexport interface MiddlewareContext {\r\n\tdispatch: Dispatcher;\r\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\r\n}\r\n\r\nexport type Middleware = (\r\n\trequest: IncomingRequest,\r\n\tenv: any,\r\n\tctx: ExecutionContext,\r\n\tmiddlewareCtx: MiddlewareContext\r\n) => Awaitable<Response>;\r\n\r\nconst __facade_middleware__: Middleware[] = [];\r\n\r\n// The register functions allow for the insertion of one or many middleware,\r\n// We register internal middleware first in the stack, but have no way of controlling\r\n// the order that addMiddleware is run in service workers so need an internal function.\r\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\r\n\t__facade_middleware__.push(...args.flat());\r\n}\r\nexport function __facade_registerInternal__(\r\n\t...args: (Middleware | Middleware[])[]\r\n) {\r\n\t__facade_middleware__.unshift(...args.flat());\r\n}\r\n\r\nfunction __facade_invokeChain__(\r\n\trequest: IncomingRequest,\r\n\tenv: any,\r\n\tctx: ExecutionContext,\r\n\tdispatch: Dispatcher,\r\n\tmiddlewareChain: Middleware[]\r\n): Awaitable<Response> {\r\n\tconst [head, ...tail] = middlewareChain;\r\n\tconst middlewareCtx: MiddlewareContext = {\r\n\t\tdispatch,\r\n\t\tnext(newRequest, newEnv) {\r\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\r\n\t\t},\r\n\t};\r\n\treturn head(request, env, ctx, middlewareCtx);\r\n}\r\n\r\nexport function __facade_invoke__(\r\n\trequest: IncomingRequest,\r\n\tenv: any,\r\n\tctx: ExecutionContext,\r\n\tdispatch: Dispatcher,\r\n\tfinalMiddleware: Middleware\r\n): Awaitable<Response> {\r\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\r\n\t\t...__facade_middleware__,\r\n\t\tfinalMiddleware,\r\n\t]);\r\n}\r\n", "// This loads all middlewares exposed on the middleware object and then starts\r\n// the invocation chain. The big idea is that we can add these to the middleware\r\n// export dynamically through wrangler, or we can potentially let users directly\r\n// add them as a sort of \"plugin\" system.\r\n\r\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\bundle-rEWJhS\\\\middleware-insertion-facade.js\";\r\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\r\nimport type { WorkerEntrypointConstructor } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\bundle-rEWJhS\\\\middleware-insertion-facade.js\";\r\n\r\n// Preserve all the exports from the worker\r\nexport * from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\bundle-rEWJhS\\\\middleware-insertion-facade.js\";\r\n\r\nclass __Facade_ScheduledController__ implements ScheduledController {\r\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\r\n\r\n\tconstructor(\r\n\t\treadonly scheduledTime: number,\r\n\t\treadonly cron: string,\r\n\t\tnoRetry: ScheduledController[\"noRetry\"]\r\n\t) {\r\n\t\tthis.#noRetry = noRetry;\r\n\t}\r\n\r\n\tnoRetry() {\r\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\r\n\t\t\tthrow new TypeError(\"Illegal invocation\");\r\n\t\t}\r\n\t\t// Need to call native method immediately in case uncaught error thrown\r\n\t\tthis.#noRetry();\r\n\t}\r\n}\r\n\r\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\r\n\t// If we don't have any middleware defined, just return the handler as is\r\n\tif (\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\r\n\t) {\r\n\t\treturn worker;\r\n\t}\r\n\t// Otherwise, register all middleware once\r\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\r\n\t\t__facade_register__(middleware);\r\n\t}\r\n\r\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\r\n\t\trequest,\r\n\t\tenv,\r\n\t\tctx\r\n\t) {\r\n\t\tif (worker.fetch === undefined) {\r\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\r\n\t\t}\r\n\t\treturn worker.fetch(request, env, ctx);\r\n\t};\r\n\r\n\treturn {\r\n\t\t...worker,\r\n\t\tfetch(request, env, ctx) {\r\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\r\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\r\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\r\n\t\t\t\t\t\tDate.now(),\r\n\t\t\t\t\t\tinit.cron ?? \"\",\r\n\t\t\t\t\t\t() => {}\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\r\n\t\t},\r\n\t};\r\n}\r\n\r\nfunction wrapWorkerEntrypoint(\r\n\tklass: WorkerEntrypointConstructor\r\n): WorkerEntrypointConstructor {\r\n\t// If we don't have any middleware defined, just return the handler as is\r\n\tif (\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\r\n\t) {\r\n\t\treturn klass;\r\n\t}\r\n\t// Otherwise, register all middleware once\r\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\r\n\t\t__facade_register__(middleware);\r\n\t}\r\n\r\n\t// `extend`ing `klass` here so other RPC methods remain callable\r\n\treturn class extends klass {\r\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\r\n\t\t\trequest,\r\n\t\t\tenv,\r\n\t\t\tctx\r\n\t\t) => {\r\n\t\t\tthis.env = env;\r\n\t\t\tthis.ctx = ctx;\r\n\t\t\tif (super.fetch === undefined) {\r\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\r\n\t\t\t}\r\n\t\t\treturn super.fetch(request);\r\n\t\t};\r\n\r\n\t\t#dispatcher: Dispatcher = (type, init) => {\r\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\r\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\r\n\t\t\t\t\tDate.now(),\r\n\t\t\t\t\tinit.cron ?? \"\",\r\n\t\t\t\t\t() => {}\r\n\t\t\t\t);\r\n\t\t\t\treturn super.scheduled(controller);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\r\n\t\t\treturn __facade_invoke__(\r\n\t\t\t\trequest,\r\n\t\t\t\tthis.env,\r\n\t\t\t\tthis.ctx,\r\n\t\t\t\tthis.#dispatcher,\r\n\t\t\t\tthis.#fetchDispatcher\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\r\nif (typeof ENTRY === \"object\") {\r\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\r\n} else if (typeof ENTRY === \"function\") {\r\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\r\n}\r\nexport default WRAPPED_ENTRY;\r\n", "import type { Middleware } from \"./common\";\r\n\r\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\r\n\ttry {\r\n\t\treturn await middlewareCtx.next(request, env);\r\n\t} finally {\r\n\t\ttry {\r\n\t\t\tif (request.body !== null && !request.bodyUsed) {\r\n\t\t\t\tconst reader = request.body.getReader();\r\n\t\t\t\twhile (!(await reader.read()).done) {}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default drainBody;\r\n", "import type { Middleware } from \"./common\";\r\n\r\ninterface JsonError {\r\n\tmessage?: string;\r\n\tname?: string;\r\n\tstack?: string;\r\n\tcause?: JsonError;\r\n}\r\n\r\nfunction reduceError(e: any): JsonError {\r\n\treturn {\r\n\t\tname: e?.name,\r\n\t\tmessage: e?.message ?? String(e),\r\n\t\tstack: e?.stack,\r\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\r\n\t};\r\n}\r\n\r\n// See comment in `bundle.ts` for details on why this is needed\r\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\r\n\ttry {\r\n\t\treturn await middlewareCtx.next(request, env);\r\n\t} catch (e: any) {\r\n\t\tconst error = reduceError(e);\r\n\t\treturn Response.json(error, {\r\n\t\t\tstatus: 500,\r\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport default jsonError;\r\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\pages-rpwfNZ\\\\functionsWorker-0.7895577924184125.mjs\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\pages-rpwfNZ\\\\functionsWorker-0.7895577924184125.mjs\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\r\n// TODO: allow dispatching more events?\r\nexport type Dispatcher = (\r\n\ttype: \"scheduled\",\r\n\tinit: { cron?: string }\r\n) => Awaitable<void>;\r\n\r\nexport type IncomingRequest = Request<\r\n\tunknown,\r\n\tIncomingRequestCfProperties<unknown>\r\n>;\r\n\r\nexport interface MiddlewareContext {\r\n\tdispatch: Dispatcher;\r\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\r\n}\r\n\r\nexport type Middleware = (\r\n\trequest: IncomingRequest,\r\n\tenv: any,\r\n\tctx: ExecutionContext,\r\n\tmiddlewareCtx: MiddlewareContext\r\n) => Awaitable<Response>;\r\n\r\nconst __facade_middleware__: Middleware[] = [];\r\n\r\n// The register functions allow for the insertion of one or many middleware,\r\n// We register internal middleware first in the stack, but have no way of controlling\r\n// the order that addMiddleware is run in service workers so need an internal function.\r\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\r\n\t__facade_middleware__.push(...args.flat());\r\n}\r\nexport function __facade_registerInternal__(\r\n\t...args: (Middleware | Middleware[])[]\r\n) {\r\n\t__facade_middleware__.unshift(...args.flat());\r\n}\r\n\r\nfunction __facade_invokeChain__(\r\n\trequest: IncomingRequest,\r\n\tenv: any,\r\n\tctx: ExecutionContext,\r\n\tdispatch: Dispatcher,\r\n\tmiddlewareChain: Middleware[]\r\n): Awaitable<Response> {\r\n\tconst [head, ...tail] = middlewareChain;\r\n\tconst middlewareCtx: MiddlewareContext = {\r\n\t\tdispatch,\r\n\t\tnext(newRequest, newEnv) {\r\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\r\n\t\t},\r\n\t};\r\n\treturn head(request, env, ctx, middlewareCtx);\r\n}\r\n\r\nexport function __facade_invoke__(\r\n\trequest: IncomingRequest,\r\n\tenv: any,\r\n\tctx: ExecutionContext,\r\n\tdispatch: Dispatcher,\r\n\tfinalMiddleware: Middleware\r\n): Awaitable<Response> {\r\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\r\n\t\t...__facade_middleware__,\r\n\t\tfinalMiddleware,\r\n\t]);\r\n}\r\n", "// This loads all middlewares exposed on the middleware object and then starts\r\n// the invocation chain. The big idea is that we can add these to the middleware\r\n// export dynamically through wrangler, or we can potentially let users directly\r\n// add them as a sort of \"plugin\" system.\r\n\r\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\bundle-4YnjdV\\\\middleware-insertion-facade.js\";\r\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\r\nimport type { WorkerEntrypointConstructor } from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\bundle-4YnjdV\\\\middleware-insertion-facade.js\";\r\n\r\n// Preserve all the exports from the worker\r\nexport * from \"D:\\\\\u6742\\\\\u97F3\u4E50\u64AD\u653E\u5668\\\\Solara\\\\.wrangler\\\\tmp\\\\bundle-4YnjdV\\\\middleware-insertion-facade.js\";\r\n\r\nclass __Facade_ScheduledController__ implements ScheduledController {\r\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\r\n\r\n\tconstructor(\r\n\t\treadonly scheduledTime: number,\r\n\t\treadonly cron: string,\r\n\t\tnoRetry: ScheduledController[\"noRetry\"]\r\n\t) {\r\n\t\tthis.#noRetry = noRetry;\r\n\t}\r\n\r\n\tnoRetry() {\r\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\r\n\t\t\tthrow new TypeError(\"Illegal invocation\");\r\n\t\t}\r\n\t\t// Need to call native method immediately in case uncaught error thrown\r\n\t\tthis.#noRetry();\r\n\t}\r\n}\r\n\r\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\r\n\t// If we don't have any middleware defined, just return the handler as is\r\n\tif (\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\r\n\t) {\r\n\t\treturn worker;\r\n\t}\r\n\t// Otherwise, register all middleware once\r\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\r\n\t\t__facade_register__(middleware);\r\n\t}\r\n\r\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\r\n\t\trequest,\r\n\t\tenv,\r\n\t\tctx\r\n\t) {\r\n\t\tif (worker.fetch === undefined) {\r\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\r\n\t\t}\r\n\t\treturn worker.fetch(request, env, ctx);\r\n\t};\r\n\r\n\treturn {\r\n\t\t...worker,\r\n\t\tfetch(request, env, ctx) {\r\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\r\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\r\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\r\n\t\t\t\t\t\tDate.now(),\r\n\t\t\t\t\t\tinit.cron ?? \"\",\r\n\t\t\t\t\t\t() => {}\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\r\n\t\t},\r\n\t};\r\n}\r\n\r\nfunction wrapWorkerEntrypoint(\r\n\tklass: WorkerEntrypointConstructor\r\n): WorkerEntrypointConstructor {\r\n\t// If we don't have any middleware defined, just return the handler as is\r\n\tif (\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\r\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\r\n\t) {\r\n\t\treturn klass;\r\n\t}\r\n\t// Otherwise, register all middleware once\r\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\r\n\t\t__facade_register__(middleware);\r\n\t}\r\n\r\n\t// `extend`ing `klass` here so other RPC methods remain callable\r\n\treturn class extends klass {\r\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\r\n\t\t\trequest,\r\n\t\t\tenv,\r\n\t\t\tctx\r\n\t\t) => {\r\n\t\t\tthis.env = env;\r\n\t\t\tthis.ctx = ctx;\r\n\t\t\tif (super.fetch === undefined) {\r\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\r\n\t\t\t}\r\n\t\t\treturn super.fetch(request);\r\n\t\t};\r\n\r\n\t\t#dispatcher: Dispatcher = (type, init) => {\r\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\r\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\r\n\t\t\t\t\tDate.now(),\r\n\t\t\t\t\tinit.cron ?? \"\",\r\n\t\t\t\t\t() => {}\r\n\t\t\t\t);\r\n\t\t\t\treturn super.scheduled(controller);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\r\n\t\t\treturn __facade_invoke__(\r\n\t\t\t\trequest,\r\n\t\t\t\tthis.env,\r\n\t\t\t\tthis.ctx,\r\n\t\t\t\tthis.#dispatcher,\r\n\t\t\t\tthis.#fetchDispatcher\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\r\nif (typeof ENTRY === \"object\") {\r\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\r\n} else if (typeof ENTRY === \"function\") {\r\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\r\n}\r\nexport default WRAPPED_ENTRY;\r\n"],
  "mappings": "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",
  "names": ["urls", "checkURL", "__name", "stripCfConnectingIPHeader", "n", "component", "k", "decode", "mcu", "i", "sample", "parse", "length", "frame", "maxH", "maxV", "componentId", "j", "onRequest", "createCorsHeaders", "handleOptions", "upstream", "headers", "value", "_a", "result", "char", "prefix", "drainBody", "middleware_ensure_req_body_drained_default", "reduceError", "jsonError", "middleware_miniflare3_json_error_default", "__INTERNAL_WRANGLER_MIDDLEWARE__", "middleware_ensure_req_body_drained_default", "middleware_miniflare3_json_error_default", "middleware_insertion_facade_default", "__facade_middleware__", "__facade_register__", "__facade_invokeChain__", "__facade_invoke__", "__facade_middleware__", "__Facade_ScheduledController__", "wrapExportedHandler", "__INTERNAL_WRANGLER_MIDDLEWARE__", "__facade_register__", "__facade_invoke__", "wrapWorkerEntrypoint", "WRAPPED_ENTRY", "middleware_insertion_facade_default", "middleware_loader_entry_default"]
}
